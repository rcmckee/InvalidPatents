<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html><head><title>Patent US6892211 - Copy on write file system consistency and block usage - Google Patents</title><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){var d=void 0!=b?b:(new Date).getTime();this.t[a]=[d,c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(e){}};this.tick("start",null,a)}var a;window.performance&&(a=window.performance.timing);var f=a?new e(a.responseStart):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_",
"_wtsrt",d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();})();
</script><link rel="stylesheet" href="/patents/css/_8a2b04e7bf975d5171d8e4c0b6365c7a/kl_intl_patents_bundle.css" type="text/css" /><script src="/books/javascript/atb_8a2b04e7bf975d5171d8e4c0b6365c7a__en.js"></script><script>function googleTranslateElementInit() {new google.translate.TranslateElement({pageLanguage: "en",gaTrack: true,gaId: "UA-27188110-1",multilanguagePage: true});}</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script><meta name="DC.type" content="Patent"><meta name="DC.title" content="Copy on write file system consistency and block usage"><meta name="DC.contributor" content="David Hitz" scheme="inventor"><meta name="DC.contributor" content="Michael Malcolm" scheme="inventor"><meta name="DC.contributor" content="James Lau" scheme="inventor"><meta name="DC.contributor" content="Byron Rakitzis" scheme="inventor"><meta name="DC.contributor" content="Network Appliance, Inc." scheme="assignee"><meta name="DC.date" content="2004-4-12" scheme="dateSubmitted"><meta name="DC.description" content="The present invention provides a method for keeping a file system in a consistent state and for creating read-only copies of a file system. Changes to the file system are tightly controlled. The file system progresses from one self-consistent state to another self-consistent state. The set of self-consistent blocks on disk that is rooted by the root inode is referred to as a consistency point. To implement consistency points, new data is written to unallocated blocks on disk. A new consistency point occurs when the fsinfo block is updated by writing a new root inode for the inode file into it. Thus, as long as the root inode is not updated, the state of the file system represented on disk does not change. The present invention also creates snapshots that are read-only copies of the file system. A snapshot uses no disk space when it is initially created. It is designed so that many different snapshots can be created for the same file system. Unlike prior art file systems that create a clone by duplicating the entire inode file and all of the indirect blocks, the present invention duplicates only the inode that describes the inode file. A multi-bit free-block map file is used to prevent data from being overwritten on disk."><meta name="DC.date" content="2005-5-10" scheme="issued"><meta name="DC.relation" content="US:20020083037:A1" scheme="references"><meta name="DC.relation" content="US:20040139125:A1" scheme="references"><meta name="DC.relation" content="US:5182805" scheme="references"><meta name="DC.relation" content="US:5623666" scheme="references"><meta name="DC.relation" content="US:5649152" scheme="references"><meta name="DC.relation" content="US:5701480" scheme="references"><meta name="DC.relation" content="US:5819292" scheme="references"><meta name="DC.relation" content="US:5873098" scheme="references"><meta name="DC.relation" content="US:5948110" scheme="references"><meta name="DC.relation" content="US:5963962" scheme="references"><meta name="DC.relation" content="US:6038570" scheme="references"><meta name="DC.relation" content="US:6138126" scheme="references"><meta name="DC.relation" content="US:6289356" scheme="references"><meta name="DC.relation" content="US:6434681" scheme="references"><meta name="DC.relation" content="US:6480969" scheme="references"><meta name="DC.relation" content="US:6640233" scheme="references"><meta name="DC.relation" content="US:6721764" scheme="references"><meta name="DC.relation" content="US:6751637" scheme="references"><meta name="DC.relation" content="US:6823336" scheme="references"><meta name="citation_reference" content="Bach, M.J. &quot;The Design of the UNIX(R) Operating System&quot;, Englewood Cliffs:Prentice Hall, 1986, pp. 38-140 and 325-329. QA76.76.O63 B33 1986. ISBN 0-13-201799-7.*"><meta name="citation_reference" content="Chutani, S. et al. &quot;The Episode File Server&quot;, USENIX, Winter 1992, pp. 43-60.*"><meta name="citation_reference" content="Hitz, D. &quot;An NFS File Server Appliance&quot;, Technical Report TR01, Network Appliance Corporation, Aug. 1993.*"><meta name="citation_reference" content="Hitz, D. et al. &quot;File System Design for an NFS File Server Appliance&quot;, USENIX, Jan. 19, 1994."><meta name="citation_reference" content="Hitz, D. et al. &quot;Using UNIX as One Component of a Lightweight Distributed Kernel for Multiprocessor File Servers&quot;, Auspex Systems Inc. Technical Report 5, Jan. 1990.*"><meta name="citation_reference" content="Schwartz, A.M. et al. &quot;LFS-A Local File System for Multiprocessor NFS Network Servers&quot;, Auspex Systems Inc. Technical Report 4, Dec. 1989.*"><meta name="citation_patent_number" content="US:6892211"><meta name="citation_patent_application_number" content="US:10/822,630"><link rel="canonical" href="http://www.google.com/patents/US6892211"/><meta property="og:url" content="http://www.google.com/patents/US6892211"/><meta name="title" content="Patent US6892211 - Copy on write file system consistency and block usage"/><meta name="description" content="The present invention provides a method for keeping a file system in a consistent state and for creating read-only copies of a file system. Changes to the file system are tightly controlled. The file system progresses from one self-consistent state to another self-consistent state. The set of self-consistent blocks on disk that is rooted by the root inode is referred to as a consistency point. To implement consistency points, new data is written to unallocated blocks on disk. A new consistency point occurs when the fsinfo block is updated by writing a new root inode for the inode file into it. Thus, as long as the root inode is not updated, the state of the file system represented on disk does not change. The present invention also creates snapshots that are read-only copies of the file system. A snapshot uses no disk space when it is initially created. It is designed so that many different snapshots can be created for the same file system. Unlike prior art file systems that create a clone by duplicating the entire inode file and all of the indirect blocks, the present invention duplicates only the inode that describes the inode file. A multi-bit free-block map file is used to prevent data from being overwritten on disk."/><meta property="og:title" content="Patent US6892211 - Copy on write file system consistency and block usage"/><meta property="og:type" content="book"/><meta property="og:site_name" content="Google Books"/><meta property="og:image" content="http://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><link rel="image_src" href="http://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"/><script>(function(){try{var aa=function(a,b,c,d){d=d||{};d._sn=["cfg",b,c].join(".");window.gbar.logger.ml(a,d)};var g=window.gbar=window.gbar||{},l=window.gbar.i=window.gbar.i||{},m={},n;function _tvn(a,b){var c=parseInt(a,10);return isNaN(c)?b:c}function _tvf(a,b){var c=parseFloat(a);return isNaN(c)?b:c}function _tvv(a){return!!a}function p(a,b,c){(c||g)[a]=b}g.bv={n:_tvn("2",0),r:"",f:".67.",e:"0",m:_tvn("0",1)};
function q(a,b,c){var d="on"+b;if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent(d,c);else{var f=a[d];a[d]=function(){var a=f.apply(this,arguments),b=c.apply(this,arguments);return void 0==a?b:void 0==b?a:b&&a}}}var s=function(a){return function(){return g.bv.m==a}},ba=s(1),ca=s(2);p("sb",ba);p("kn",ca);l.a=_tvv;l.b=_tvf;l.c=_tvn;l.i=aa;var da=window.gbar.i.i;var t,u,v,w;function ea(a){v=a}function fa(a){var b;if(b=v&&window.encodeURIComponent)b=a.href,b=!b.match(/^http[s]?:\/\/accounts\.google\.[^/]*\/ClearSID/i)&&!b.match(/^http[s]?:\/\/[^/]*\/accounts\/ClearSID/i);if(b=b&&encodeURIComponent(v()))a.href=a.href.replace(/([?&]continue=)[^&]*/,"$1"+b)}function ga(a){window.gApplication&&(a.href=window.gApplication.getTabUrl(a.href))}
function ha(a){var b=document.forms[0].q,c=window.encodeURIComponent&&b&&b.value,b=b&&b.placeholder;c&&c!=b&&(a.href=a.href.replace(/([?&])q=[^&]*|$/,function(a,b){return(b||"&")+"q="+encodeURIComponent(c)}))}n=l.a("")?ga:ha;
function x(a,b,c,d,f,e){var h=document.getElementById(a);if(h){var k=h.style;k.left=d?"auto":b+"px";k.right=d?b+"px":"auto";k.top=c+"px";k.visibility=u?"hidden":"visible";f&&e?(k.width=f+"px",k.height=e+"px"):(x(t,b,c,d,h.offsetWidth,h.offsetHeight),u=u?"":a)}}
var y=[],ia=function(a,b){y.push(b)},ja=function(a){a=a||window.event;var b=a.target||a.srcElement;a.cancelBubble=!0;null==t&&(a=document.createElement(Array.every||window.createPopup?"iframe":"div"),a.frameBorder="0",t=a.id="gbs",a.src="javascript:''",b.parentNode.appendChild(a),q(document,"click",z));var c=b,b=0;"gb3"!=c.className&&(c=c.parentNode);a=c.getAttribute("aria-owns")||"gbi";var d=c.offsetWidth,f=20<c.offsetTop?46:24;document.getElementById("tphdr")&&(f-=3);var e=!1;do b+=c.offsetLeft||
0;while(c=c.offsetParent);var c=(document.documentElement.clientWidth||document.body.clientWidth)-b-d,h,d=document.body,k=document.defaultView;k&&k.getComputedStyle?(d=k.getComputedStyle(d,""))&&(h=d.direction):h=d.currentStyle?d.currentStyle.direction:d.style.direction;h="rtl"==h;if("gbi"==a){for(d=0;k=y[d++];)k();A(null,window.navExtra);h&&(b=c,e=!0)}else h||(b=c,e=!0);u!=a&&z();x(a,b,f,e)},z=function(){u&&x(u,0,0)},A=function(a,b){var c,d=document.getElementById("gbi"),f=a;f||(f=d.firstChild);
for(;b&&(c=b.pop());){var e=d,h=c,k=f;w||(w="gb2");e.insertBefore(h,k).className=w}},ka=function(a,b,c){if((b=document.getElementById(b))&&a){a.className="gb4";var d=document.createElement("span");d.appendChild(a);d.appendChild(document.createTextNode(" | "));d.id=c;b.appendChild(d)}},la=function(){return document.getElementById("gb_70")},ma=function(){return!!u};p("qs",n);p("setContinueCb",ea);p("pc",fa);p("tg",ja);p("close",z);p("addLink",ka);p("almm",A);p("si",la);p("adh",ia);p("op",ma);var B=function(){},C=function(){},F=function(a){var b=new Image,c=D;b.onerror=b.onload=b.onabort=function(){try{delete E[c]}catch(a){}};E[c]=b;b.src=a;D=c+1},E=[],D=0;p("logger",{il:C,ml:B,log:F});var G=window.gbar.logger;var H={},na={},I=[],oa=l.b("0.1",.1),pa=l.a("1",!0),qa=function(a,b){I.push([a,b])},ra=function(a,b){H[a]=b},sa=function(a){return a in H},J={},K=function(a,b){J[a]||(J[a]=[]);J[a].push(b)},ta=function(a){K("m",a)},L=function(a,b){var c=document.createElement("script");c.src=a;c.async=pa;Math.random()<oa&&(c.onerror=function(){c.onerror=null;B(Error("Bundle load failed: name="+(b||"UNK")+" url="+a))});(document.getElementById("xjsc")||document.getElementsByTagName("body")[0]||
document.getElementsByTagName("head")[0]).appendChild(c)},N=function(a){for(var b=0,c;(c=I[b])&&c[0]!=a;++b);!c||c[1].l||c[1].s||(c[1].s=!0,M(2,a),c[1].url&&L(c[1].url,a),c[1].libs&&m.d&&m.d(c[1].libs))},O=function(a){K("gc",a)},P=null,ua=function(a){P=a},M=function(a,b,c){if(P){a={t:a,b:b};if(c)for(var d in c)a[d]=c[d];try{P(a)}catch(f){}}};p("mdc",H);p("mdi",na);p("bnc",I);p("qGC",O);p("qm",ta);p("qd",J);p("lb",N);p("mcf",ra);p("bcf",qa);p("aq",K);p("mdd","");p("has",sa);
p("trh",ua);p("tev",M);var Q=l.b("0.1",.001),R=0;
function _mlToken(a,b){try{if(1>R){R++;var c,d=a,f=b||{},e=encodeURIComponent,h=["//www.google.com/gen_204?atyp=i&zx=",(new Date).getTime(),"&jexpid=",e("17483"),"&srcpg=",e("prop=22"),"&jsr=",Math.round(1/Q),"&ogev=",e("f0nsU5z_FMXFggSU_4KwDA"),"&ogf=",g.bv.f,"&ogrp=",e("1"),"&ogv=",e("1407723702.0"),"&oggv="+e("es_plusone_gc_20140723.0_p0"),"&ogd=",e("com"),"&ogc=",e("BRA"),"&ogl=",e("en")];f._sn&&(f._sn="og."+
f._sn);for(var k in f)h.push("&"),h.push(e(k)),h.push("="),h.push(e(f[k]));h.push("&emsg=");h.push(e(d.name+":"+d.message));var r=h.join("");S(r)&&(r=r.substr(0,2E3));c=r;var Aa=window.gbar.logger._aem(a,c);F(Aa)}}catch(Na){}}var S=function(a){return 2E3<=a.length},va=function(a,b){return b};function T(a){B=a;p("_itl",S,G);p("_aem",va,G);p("ml",B,G);a={};H.er=a}l.a("")?T(function(a){throw a;}):l.a("1")&&Math.random()<Q&&T(_mlToken);I.push(["m",{url:"//ssl.gstatic.com/gb/js/scm_7385cc5883250b43a39405734c1bea59.js"}]);g.mcf("c",{});g.sg={c:""};if(l.a("1")){var wa=l.a("");I.push(["gc",{auto:wa,url:"//ssl.gstatic.com/gb/js/abc/gci_91f30755d6a6b787dcc2a4062e6e9824.js",libs:"googleapis.client:plusone:gapi.iframes"}]);var xa={version:"gci_91f30755d6a6b787dcc2a4062e6e9824.js",index:"",lang:"en"};H.gc=xa;var U=function(a){window.googleapis&&window.iframes?a&&a():(a&&O(a),N("gc"))};p("lGC",U);l.a("1")&&p("lPWF",U)};window.__PVT="";if(l.a("1")&&l.a("1")){var V=function(a){U(function(){K("pw",a);N("pw")})};p("lPW",V);I.push(["pw",{url:"//ssl.gstatic.com/gb/js/abc/pwm_45f73e4df07a0e388b0fa1f3d30e7280.js"}]);var W=[],ya=function(a){W[0]=a},za=function(a,b){var c=b||{};c._sn="pw";B(a,c)},Ba={signed:W,elog:za,base:"https://plusone.google.com/u/0",loadTime:(new Date).getTime()};H.pw=Ba;var X=function(a,b){for(var c=b.split("."),d=function(){var b=arguments;a(function(){for(var a=g,d=0,e=c.length-1;d<e;++d)a=a[c[d]];a[c[d]].apply(a,b)})},f=g,e=0,h=c.length-1;e<h;++e)f=
f[c[e]]=f[c[e]]||{};return f[c[e]]=d};X(V,"pw.clk");X(V,"pw.hvr");p("su",ya,g.pw)};function Ca(){function a(){for(var b;(b=e[h++])&&"m"!=b[0]&&!b[1].auto;);b&&(M(2,b[0]),b[1].url&&L(b[1].url,b[0]),b[1].libs&&m.d&&m.d(b[1].libs));h<e.length&&setTimeout(a,0)}function b(){0<f--?setTimeout(b,0):a()}var c=l.a("1"),d=l.a(""),f=3,e=I,h=0,k=window.gbarOnReady;if(k)try{k()}catch(r){da(r,"ml","or")}d?p("ldb",a):c?q(window,"load",b):b()}p("rdl",Ca);var Da={D:1,H:2,da:3,p:4,W:5,M:6,F:7,g:8,ha:9,U:10,L:11,T:12,S:13,N:14,Q:15,P:16,fa:17,w:18,O:19,ga:20,ea:21,u:22,G:23,ja:24,ka:25,ia:26,A:27,j:28,o:29,k:30,ca:31,Z:32,$:33,J:34,K:35,ba:36,aa:37,Y:38,B:39,R:40,v:41,X:42,V:43,h:48,C:49,I:500},Y=[1,2,3,4,5,6,9,10,11,13,14,28,29,30,34,35,37,38,39,40,41,42,43,48,49,500];var Z=l.b("0.001",1E-4),Ea=l.b("1",1),Fa=!1,Ga=!1;if(l.a("1")){var Ha=Math.random();Ha<=Z&&(Fa=!0);Ha<=Ea&&(Ga=!0)}var Ia=Da,$=null;function Ja(){var a=0,b=function(b,d){l.a(d)&&(a|=b)};b(1,"");b(2,"");b(4,"");b(8,"");return a}
function Ka(a,b){var c=Z,d=Fa,f;f=a;if(!$){$={};for(var e=0;e<Y.length;e++){var h=Y[e];$[h]=!0}}if(f=!!$[f])c=Ea,d=Ga;if(d){d=encodeURIComponent;g.rp?(f=g.rp(),f="-1"!=f?f:"1"):f="1";c=["//www.google.com/gen_204?atyp=i&zx=",(new Date).getTime(),"&oge=",a,"&ogex=",d("17483"),"&ogev=",d("f0nsU5z_FMXFggSU_4KwDA"),"&ogf=",g.bv.f,"&ogp=",d("22"),"&ogrp=",d(f),"&ogsr=",Math.round(1/c),"&ogv=",d("1407723702.0"),"&oggv="+
d("es_plusone_gc_20140723.0_p0"),"&ogd=",d("com"),"&ogl=",d("en"),"&ogc=",d("BRA"),"&ogus=",Ja()];if(b){"ogw"in b&&(c.push("&ogw="+b.ogw),delete b.ogw);var k;f=b;e=[];for(k in f)0!=e.length&&e.push(","),e.push(La(k)),e.push("."),e.push(La(f[k]));k=e.join("");""!=k&&(c.push("&ogad="),c.push(d(k)))}F(c.join(""))}}function La(a){"number"==typeof a&&(a+="");return"string"==typeof a?a.replace(".","%2E").replace(",","%2C"):a}C=Ka;p("il",C,G);var Ma={};H.il=Ma;setTimeout(function(){C(Ia.g)},0);}catch(e){window.gbar&&gbar.logger&&gbar.logger.ml(e,{"_sn":"cfg.init"});}})();
(function(){try{var b=window.gbar.i.i;var c=window.gbar;var f=function(d){try{var a=document.getElementById("gbom");a&&d.appendChild(a.cloneNode(!0))}catch(e){b(e,"omas","aomc")}};c.aomc=f;}catch(e){window.gbar&&gbar.logger&&gbar.logger.ml(e,{"_sn":"cfg.init"});}})();
(function(){try{var a=window.gbar;a.mcf("pm",{p:""});}catch(e){window.gbar&&gbar.logger&&gbar.logger.ml(e,{"_sn":"cfg.init"});}})();
(function(){try{window.gbar.rdl();}catch(e){window.gbar&&gbar.logger&&gbar.logger.ml(e,{"_sn":"cfg.init"});}})();
if (window['_OC_timingAction']) {window['_OC_timingAction']('patents_refpage');}</script><style>#gbar,#guser{font-size:13px;padding-top:1px !important;}#gbar{float:left;height:22px}#guser{padding-bottom:7px !important;text-align:right}.gbh,.gbd{border-top:1px solid #c9d7f1;font-size:1px}.gbh{height:0;position:absolute;top:24px;width:100%}#gbs,.gbm{background:#fff;left:0;position:absolute;text-align:left;visibility:hidden;z-index:1000}.gbm{border:1px solid;border-color:#c9d7f1 #36c #36c #a2bae7;z-index:1001}.gb1{margin-right:.5em}.gb1,.gb3{zoom:1}.gb2{display:block;padding:.2em .5em}.gb2,.gb3{text-decoration:none !important;border-bottom:none}a.gb1,a.gb4{text-decoration:underline !important}a.gb1,a.gb2,a.gb3,a.gb4{color:#00c !important}.gbi .gb3,.gbi .gb2,.gbi .gb4{color:#dd8e27 !important}.gbf .gb3,.gbf .gb2,.gbf .gb4{color:#900 !important}a.gb2:hover{background:#36c;color:#fff !important}#gbar .gbz0l{color:#000 !important;cursor:default;font-weight:bold;text-decoration:none !important}
#gbar { padding:.3em .6em !important;}</style></head><body  topmargin="3" marginheight="3"><div id=gbar><nobr><a onclick=gbar.qs(this);gbar.logger.il(1,{t:1}); class=gb1 id=gb_1 href="https://www.google.com/search?sa=N&tab=tw">Search</a> <a onclick=gbar.qs(this);gbar.logger.il(1,{t:2}); class=gb1 id=gb_2 href="http://www.google.com/search?hl=en&tbm=isch&source=og&sa=N&tab=ti">Images</a> <a onclick=gbar.qs(this);gbar.logger.il(1,{t:8}); class=gb1 id=gb_8 href="http://maps.google.com/maps?hl=en&sa=N&tab=tl">Maps</a> <a onclick=gbar.qs(this);gbar.logger.il(1,{t:78}); class=gb1 id=gb_78 href="https://play.google.com/?hl=en&sa=N&tab=t8">Play</a> <a onclick=gbar.qs(this);gbar.logger.il(1,{t:36}); class=gb1 id=gb_36 href="http://www.youtube.com/results?sa=N&tab=t1">YouTube</a> <a onclick=gbar.logger.il(1,{t:5}); class=gb1 id=gb_5 href="http://news.google.com/nwshp?hl=en&tab=tn">News</a> <a onclick=gbar.logger.il(1,{t:23}); class=gb1 id=gb_23 href="https://mail.google.com/mail/?tab=tm">Gmail</a> <a onclick=gbar.logger.il(1,{t:25}); class=gb1 id=gb_25 href="https://drive.google.com/?tab=to">Drive</a> <a class=gb3 href="http://www.google.com/intl/en/options/" onclick="this.blur();gbar.tg(event);return !1" aria-haspopup=true><u>More</u> <small>&#9660;</small></a><div class=gbm id=gbi><a onclick=gbar.logger.il(1,{t:24}); class=gb2 id=gb_24 href="https://www.google.com/calendar?tab=tc">Calendar</a><a onclick=gbar.qs(this);gbar.logger.il(1,{t:51}); class=gb2 id=gb_51 href="http://translate.google.com/?hl=en&sa=N&tab=tT">Translate</a><a onclick=gbar.logger.il(1,{t:17}); class=gb2 id=gb_17 href="http://www.google.com/mobile/?hl=en&tab=tD">Mobile</a><a onclick=gbar.qs(this);gbar.logger.il(1,{t:10}); class=gb2 id=gb_10 href="http://www.google.com/search?hl=en&tbo=u&tbm=bks&source=og&sa=N&tab=tp">Books</a><a onclick=gbar.logger.il(1,{t:212}); class=gb2 id=gb_212 href="https://wallet.google.com/manage/?tab=ta">Wallet</a><a onclick=gbar.qs(this);gbar.logger.il(1,{t:6}); class=gb2 id=gb_6 href="http://www.google.com/search?hl=en&tbo=u&tbm=shop&source=og&sa=N&tab=tf">Shopping</a><a onclick=gbar.logger.il(1,{t:30}); class=gb2 id=gb_30 href="http://www.blogger.com/?tab=tj">Blogger</a><a onclick=gbar.qs(this);gbar.logger.il(1,{t:27}); class=gb2 id=gb_27 href="http://www.google.com/finance?sa=N&tab=te">Finance</a><a onclick=gbar.qs(this);gbar.logger.il(1,{t:31}); class=gb2 id=gb_31 href="https://plus.google.com/photos?sa=N&tab=tq">Photos</a><a onclick=gbar.qs(this);gbar.logger.il(1,{t:12}); class=gb2 id=gb_12 href="http://www.google.com/search?hl=en&tbo=u&tbm=vid&source=og&sa=N&tab=tv">Videos</a><div class=gb2><div class=gbd></div></div><a onclick=gbar.logger.il(1,{t:66}); href="http://www.google.com/intl/en/options/" class=gb2>Even more &raquo;</a></div></nobr></div><div id=guser width=100%><nobr><span id=gbn class=gbi></span><span id=gbf class=gbf></span><span id=gbe></span><a target=_top id=gb_70 href="https://www.google.com/accounts/Login?service=&continue=http://www.google.com/patents%3Fhl%3Den&hl=en" class=gb4>Sign in</a><div style="display: none"><div class=gbm id=gbd5 aria-owner=gbg5><div class=gbmc><ol id=gbom class=gbmcc></ol></div></div></div></nobr></div><div class=gbh style=left:0></div><div class=gbh style=right:0></div><div role="alert" style="position: absolute; left: 0; right: 0;"><a href="http://www.google.com/patents/us6892211?hl=en&amp;output=html_text" title="Screen reader users: click this link for accessible mode. Accessible mode has the same essential features but works better with your reader."><img border="0" src="http://www.google.com/images/cleardot.gif"alt="Screen reader users: click this link for accessible mode. Accessible mode has the same essential features but works better with your reader."></a></div><div id="guser"><nobr></nobr></div><div style="clear:both;"></div><div id="gb-top-search-box" class="gb-top-search-box-small gb-reset"><table><tr><td class="logo"><a href="http://www.google.com/patents" class="logo-link"><img class="logo-img" src="/intl/en/images/logos/google_logo_41.png" alt="Go to Google Books Home" height="41"/></a></td><td><form action="http://www.google.com/search" name="f" id="vheadf" method="get"><span id="hf"></span><input type="hidden" name="tbm" value="pts"/><input type="hidden" name="tbo" value="1"/><input type="hidden" name="hl" value="en"/><table><tr><td><div class="inputs"><table><tr><td><div class="text-input"><input type="text" name="q" id="vheadq" class="text" maxlength="2048" size="31" value="" title="Search Patents" accesskey="s" autocomplete="off"/><script>window._OC_autoDir &&window._OC_autoDir('vheadq', 'tia-vheadq');</script></div></td><td><div class="submit-input"><input name="btnG" class="submit" type="submit" value=""/></div></td></tr></table></div></td><td class="col-ext-links"><div class="ext-links"><a href="http://www.google.com/advanced_patent_search">&lt;nobr&gt;Advanced Patent Search&lt;/nobr&gt;</a></div></td></tr></table></form></td></tr></table></div><div class="kd-appbar"><h2 class="kd-appname"><a href="/patents">Patents</a></h2><div class="kd-buttonbar left" id="left-toolbar-buttons"><a id="appbar-write-review-link" href=""></a><a id="appbar-view-print-sample-link" href=""></a><a id="appbar-view-ebook-sample-link" href=""></a><a id="appbar-patents-prior-art-finder-link" href="https://www.google.com/patents/related/US6892211"></a><a id="appbar-patents-discuss-this-link" href="http://www.google.com/url?id=x4BsBAABERAJ&amp;q=http://patents.stackexchange.com/redirect/google-patents%3Fpatent%3DUS6892211&amp;usg=AFQjCNHGiRs5l4_IxSAGxiTlMovCLLMz7w" data-is-grant="true"></a><a id="appbar-read-patent-link" href="//docs.google.com/viewer?url=patentimages.storage.googleapis.com/pdfs/US6892211.pdf"></a><a id="appbar-download-pdf-link" href="//patentimages.storage.googleapis.com/pdfs/US6892211.pdf"></a><a class="appbar-application-grant-link" data-label="Application" href="/patents/US20040260673"></a><a class="appbar-application-grant-link" data-selected="true" data-label="Grant" href="/patents/US6892211"></a></div><div class="kd-buttonbar right" id="right-toolbar-buttons"></div></div><div id="books-microdata" itemscope=""itemtype="http://schema.org/Book"itemid="http://www.google.com/patents/US6892211" style="display:none"><span itemprop="description">The present invention provides a method for keeping a file system in a consistent state and for creating read-only copies of a file system. Changes to the file system are tightly controlled. The file system progresses from one self-consistent state to another self-consistent state. The set of self-consistent...</span><span itemprop="url">http://www.google.com/patents/US6892211?utm_source=gb-gplus-share</span><span class="main-title" itemprop="name">Patent US6892211 - Copy on write file system consistency and block usage</span><img itemprop="image" src="http://www.google.com/patents?id=&amp;printsec=frontcover&amp;img=1&amp;zoom=1"alt="Patent US6892211 - Copy on write file system consistency and block usage" title="Patent US6892211 - Copy on write file system consistency and block usage"></div><div style="display: none"><ol id="ofe-gear-menu-contents" class="gbmcc"><li class="gbe gbmtc"><a class="gbmt goog-menuitem-content" id="" href="http://www.google.com/advanced_patent_search">Advanced Patent Search</a></li></ol></div><table id="viewport_table" cellpadding="0" style="clear:both" cellspacing="0"><tr><td id="viewport_td"><div class=vertical_module_list_row><div id=intl_patents class=about_content><div id=intl_patents_v><table class="patent-bibdata"><tr><td class="patent-bibdata-heading">Publication number</td><td class="single-patent-bibdata">US6892211 B2</td></tr><tr><td class="patent-bibdata-heading">Publication type</td><td class="single-patent-bibdata">Grant</td></tr><tr><td class="patent-bibdata-heading">Application number</td><td class="single-patent-bibdata">US 10/822,630</td></tr><tr><td class="patent-bibdata-heading">Publication date</td><td class="single-patent-bibdata">May 10, 2005</td></tr><tr><td class="patent-bibdata-heading">Filing date</td><td class="single-patent-bibdata">Apr 12, 2004</td></tr><tr><td class="patent-bibdata-heading">Priority date<span class="patent-tooltip-anchor patent-question-icon"data-tooltip-text="The priority date is an assumption and is not a legal conclusion. Google has not performed a legal analysis and makes no representation as to the accuracy of the date listed."></span></td><td class="single-patent-bibdata">Jun 3, 1993</td></tr><tr><td class="patent-bibdata-heading">Fee status<span class="patent-tooltip-anchor patent-question-icon"data-tooltip-text="The fee status is an assumption and is not a legal conclusion. Google has not performed a legal analysis and makes no representation as to the accuracy of the status or dates listed."></span></td><td class="single-patent-bibdata">Paid</td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">Also published as</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/US5963962">US5963962</a>, </span><span class="patent-bibdata-value"><a href="/patents/US6289356">US6289356</a>, </span><span class="patent-bibdata-value"><a href="/patents/US6721764">US6721764</a>, </span><span class="patent-bibdata-value"><a href="/patents/US20020091670">US20020091670</a>, </span><span class="patent-bibdata-value"><a href="/patents/US20040260673">US20040260673</a></span></span></td></tr><tr class="patent-bibdata-list-row alternate-patent-number"><td class="patent-bibdata-heading">Publication number</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value">10822630, </span><span class="patent-bibdata-value">822630, </span><span class="patent-bibdata-value">US 6892211 B2, </span><span class="patent-bibdata-value">US 6892211B2, </span><span class="patent-bibdata-value">US-B2-6892211, </span><span class="patent-bibdata-value">US6892211 B2, </span><span class="patent-bibdata-value">US6892211B2</span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">Inventors</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="http://www.google.com/search?tbo=p&tbm=pts&hl=en&q=ininventor:%22David+Hitz%22">David Hitz</a>, </span><span class="patent-bibdata-value"><a href="http://www.google.com/search?tbo=p&tbm=pts&hl=en&q=ininventor:%22Michael+Malcolm%22">Michael Malcolm</a>, </span><span class="patent-bibdata-value"><a href="http://www.google.com/search?tbo=p&tbm=pts&hl=en&q=ininventor:%22James+Lau%22">James Lau</a>, </span><span class="patent-bibdata-value"><a href="http://www.google.com/search?tbo=p&tbm=pts&hl=en&q=ininventor:%22Byron+Rakitzis%22">Byron Rakitzis</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">Original Assignee</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="http://www.google.com/search?tbo=p&tbm=pts&hl=en&q=inassignee:%22Network+Appliance,+Inc.%22">Network Appliance, Inc.</a></span></span></td></tr><tr class="patent-bibdata-list-row "><td class="patent-bibdata-heading">Export Citation</td><td><span class="patent-bibdata-value-list"><span class="patent-bibdata-value"><a href="/patents/US6892211.bibtex">BiBTeX</a>, </span><span class="patent-bibdata-value"><a href="/patents/US6892211.enw">EndNote</a>, </span><span class="patent-bibdata-value"><a href="/patents/US6892211.ris">RefMan</a></span></span></td></tr><tr class="patent-internal-links"><td colspan=2><span class="patent-bibdata-value"><a href="#backward-citations">Patent Citations</a> (19),</span> <span class="patent-bibdata-value"><a href="#npl-citations">Non-Patent Citations</a> (6),</span> <span class="patent-bibdata-value"><a href="#forward-citations">Referenced by</a> (100),</span> <span class="patent-bibdata-value"><a href="#classifications">Classifications</a> (15),</span> <span class="patent-bibdata-value"><a href="#legal-events">Legal Events</a> (4)</span> </td></tr><tr><td colspan=2 class="patent-bibdata-external-link-spacer-top"></td></tr><tr class="patent-bibdata-external-link-spacer-bottom"></tr><tr><td colspan=2><span class="patent-bibdata-heading">External Links:&nbsp;</span><span><span class="patent-bibdata-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://patft.uspto.gov/netacgi/nph-Parser%3FSect2%3DPTO1%26Sect2%3DHITOFF%26p%3D1%26u%3D/netahtml/PTO/search-bool.html%26r%3D1%26f%3DG%26l%3D50%26d%3DPALL%26RefSrch%3Dyes%26Query%3DPN/6892211&usg=AFQjCNHy1j2exp-MVy6hYQHJE8AvVboxcQ">USPTO</a>, </span><span class="patent-bibdata-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://assignments.uspto.gov/assignments/q%3Fdb%3Dpat%26pat%3D6892211&usg=AFQjCNG8iGi1-gSkTpJUDHMIWohPQvqgjQ">USPTO Assignment</a>, </span><span class="patent-bibdata-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://worldwide.espacenet.com/publicationDetails/biblio%3FCC%3DUS%26NR%3D6892211B2%26KC%3DB2%26FT%3DD&usg=AFQjCNEiNariuQpgpWprH-9KE8BHuRWNhA">Espacenet</a></span></span></td></tr><tr class="patent-bibdata-group-spacer"></tr></table><div class="number-and-title"><span class="patent-title"><invention-title mxw-id="PT55413392" lang="EN" load-source="patent-office">Copy on write file system consistency and block usage</invention-title></span><br><span class="patent-number">US 6892211 B2</span></div><div class="patent-section patent-abstract-section"><div class="patent-section-header"><span class="patent-section-title">Abstract</span></div><div class="patent-text"><abstract mxw-id="PA50821000" lang="EN" load-source="patent-office"> <div num="p-0001" class="abstract">The present invention provides a method for keeping a file system in a consistent state and for creating read-only copies of a file system. Changes to the file system are tightly controlled. The file system progresses from one self-consistent state to another self-consistent state. The set of self-consistent blocks on disk that is rooted by the root inode is referred to as a consistency point. To implement consistency points, new data is written to unallocated blocks on disk. A new consistency point occurs when the fsinfo block is updated by writing a new root inode for the inode file into it. Thus, as long as the root inode is not updated, the state of the file system represented on disk does not change. The present invention also creates snapshots that are read-only copies of the file system. A snapshot uses no disk space when it is initially created. It is designed so that many different snapshots can be created for the same file system. Unlike prior art file systems that create a clone by duplicating the entire inode file and all of the indirect blocks, the present invention duplicates only the inode that describes the inode file. A multi-bit free-block map file is used to prevent data from being overwritten on disk.</div>
  </abstract></div></div><div class="patent-section patent-drawings-section"><div class="patent-section-header"><span class="patent-section-title">Images<span class="patent-section-count">(41)</span></span></div><div class="patent-drawings-body"><div class="patent-drawings-carousel"><div class="drawings"><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00000.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00000.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00001.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00001.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00002.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00002.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00003.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00003.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00004.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00004.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00005.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00005.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00006.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00006.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00007.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00007.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00008.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00008.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00009.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00009.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00010.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00010.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00011.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00011.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00012.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00012.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00013.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00013.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00014.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00014.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00015.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00015.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00016.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00016.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00017.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00017.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00018.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00018.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00019.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00019.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00020.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00020.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00021.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00021.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00022.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00022.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00023.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00023.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00024.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00024.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00025.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00025.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00026.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00026.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00027.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00027.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00028.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00028.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00029.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00029.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00030.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00030.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00031.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00031.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00032.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00032.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00033.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00033.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00034.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00034.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00035.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00035.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00036.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00036.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00037.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00037.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00038.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00038.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00039.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00039.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div><div class="patent-image"><div class="patent-thumbnail"><a href="//patentimages.storage.googleapis.com/US6892211B2/US06892211-20050510-D00040.png"><img class="patent-thumbnail-image" alt="Patent Drawing"src="//patentimages.storage.googleapis.com/thumbnails/US6892211B2/US06892211-20050510-D00040.png" /></a></div><div class="patent-thumbnail-caption">&nbsp;</div></div></div></div><div class="patent-drawings-control patent-drawings-prev"><img class="patent-drawings-button-img" alt="Previous page"src="/googlebooks/images/kennedy/page_left.png"width="21" height="21" /></div><div class="patent-drawings-control patent-drawings-next"><img class="patent-drawings-button-img" alt="Next page"src="/googlebooks/images/kennedy/page_right.png"width="21" height="21" /></div></div></div><div class="patent-post-drawings"></div><div class="patent-section patent-claims-section"><div class="patent-section-header"><span class="patent-section-title">Claims<span class="patent-section-count">(24)</span></span></div><div class="patent-text"><div mxw-id="PCLM8841683" lang="EN" load-source="patent-office" class="claims">
    <div class="claim"> <div id="CLM-00001" num="00001" class="claim">
      <div class="claim-text">1. A method of maintaining a file system stored in a memory and on a storage system that includes one or more hard disks, said method comprising steps of:
<div class="claim-text">maintaining an on-disk root inode on said storage system, said on-disk root inode pointing directly and indirectly to a first set of blocks on said storage system that store a first consistent state of said file system; and </div>
<div class="claim-text">maintaining an incore root inode in said memory, said incore root inode pointing directly and indirectly to buffers in said memory and a second set of blocks on said storage system, said buffers and said second set of blocks storing data and metadata for a second consistent state of said file system, said second set of blocks including at least some blocks in said first set of blocks, with changes between said first consistent state and said second consistent state being stored in said buffers and in ones of said second set of blocks not pointed to by said on-disk inode. </div>
</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00002" num="00002" class="claim">
      <div class="claim-text">2. A method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, wherein said file system on said storage system always moves atomically from said first consistent state to said second consistent state.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00003" num="00003" class="claim">
      <div class="claim-text">3. A method as in <claim-ref idref="CLM-00002">claim 2</claim-ref>, wherein said file system on said storage system moves atomically to said second consistent state by flushing said changes from said buffers to said storage system before updating said on-disk root inode with information from said incore root inode.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00004" num="00004" class="claim">
      <div class="claim-text">4. A method as in <claim-ref idref="CLM-00003">claim 3</claim-ref>, wherein updating said on-disk root inode further comprises updating said on-disk root inode and then a copy of said on-disk root inode such that if updating said on-disk root inode is interrupted, said copy of said on-disk root inode still points to said first consistent state of said file system.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00005" num="00005" class="claim">
      <div class="claim-text">5. A method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising the step of creating a snapshot of said file system by copying only said on-disk root inode.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00006" num="00006" class="claim">
      <div class="claim-text">6. A method as in <claim-ref idref="CLM-00005">claim 5</claim-ref>, wherein when said snapshot is created, said snapshot and said file system share said first set of blocks on said storage system.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00007" num="00007" class="claim">
      <div class="claim-text">7. A method as in <claim-ref idref="CLM-00001">claim 1</claim-ref>, further comprising the step of creating plural snapshots of said file system by copying only said on-disk root inode at different times.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00008" num="00008" class="claim">
      <div class="claim-text">8. A method as in <claim-ref idref="CLM-00007">claim 7</claim-ref>, wherein when each one of said plural snapshots is created, each one of said snapshots and said file system share said first set of blocks on said storage system.</div>
    </div>
    </div> <div class="claim"> <div id="CLM-00009" num="00009" class="claim">
      <div class="claim-text">9. A device comprising:
<div class="claim-text">a processor; </div>
<div class="claim-text">a memory; and </div>
<div class="claim-text">a storage system including one or more hard disks; </div>
<div class="claim-text">wherein said memory and said storage system store a file system; and </div>
<div class="claim-text">wherein said memory also stores information including instructions executable by said processor to maintain said file system, the instructions including steps of (a) maintaining an on-disk root inode on said storage system, said on-disk root inode pointing directly and indirectly to a first set of blocks on said storage system that store a first consistent state of said file system, and (b) maintaining an incore root inode in said memory, said incore root inode pointing directly and indirectly to buffers in said memory and a second set of blocks on said storage system, said buffers and said second set of blocks storing data and metadata for a second consistent state of said file system, said second set of blocks including at least some blocks in said first set of blocks, with changes between said first consistent state and said second consistent state being stored in said buffers and in ones of said second set of blocks not pointed to by said on-disk inode. </div>
</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00010" num="00010" class="claim">
      <div class="claim-text">10. A device as in <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein said file system on said storage system always moves atomically from said first consistent state to said second consistent state.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00011" num="00011" class="claim">
      <div class="claim-text">11. A device as in <claim-ref idref="CLM-00010">claim 10</claim-ref>, wherein said file system on said storage system moves atomically to said second consistent state by flushing said changes from said buffers to said storage system before updating said on-disk root inode with information from said incore root inode.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00012" num="00012" class="claim">
      <div class="claim-text">12. A device as in <claim-ref idref="CLM-00011">claim 11</claim-ref>, wherein updating said on-disk root inode further comprises updating said on-disk root inode and then a copy of said on-disk root inode such that if updating said on-disk root inode is interrupted, said copy of said on-disk root inode still points to said first consistent state of said file system.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00013" num="00013" class="claim">
      <div class="claim-text">13. A device as in <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the instructions further comprise the step of creating a snapshot of said file system by copying only said on-disk root inode.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00014" num="00014" class="claim">
      <div class="claim-text">14. A device as in <claim-ref idref="CLM-00013">claim 13</claim-ref>, wherein when said snapshot is created, said snapshot and said file system share said first set of blocks on said storage system.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00015" num="00015" class="claim">
      <div class="claim-text">15. A device as in <claim-ref idref="CLM-00009">claim 9</claim-ref>, wherein the instructions further comprise the step of creating plural snapshots of said file system by copying only said on-disk root inode at different times.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00016" num="00016" class="claim">
      <div class="claim-text">16. A device as in <claim-ref idref="CLM-00015">claim 15</claim-ref>, wherein when each one of said plural snapshots is created, each one of said snapshots and said file system share said first set of blocks on said storage system.</div>
    </div>
    </div> <div class="claim"> <div id="CLM-00017" num="00017" class="claim">
      <div class="claim-text">17. An article of manufacture comprising a machine-readable storage medium storing instructions executable by a processor coupled to a memory and to a storage system, said storage system comprising one or more hard disks, said memory and said storage system storing a file system, wherein the instructions, when executed by the processor, cause the processor to (a) maintain an on-disk root inode on said storage system, said on-disk root inode pointing directly and indirectly to a first set of blocks on said storage system that store a first consistent state of said file system, and (b) maintain an incore root inode in said memory, said incore root inode pointing directly and indirectly to buffers in said memory and a second set of blocks on said storage system, said buffers and said second set of blocks storing data and metadata for a second consistent state of said file system, said second set of blocks including at least some blocks in said first set of blocks, with changes between said first consistent state and said second consistent state being stored in said buffers and in ones of said second set of blocks not pointed to by said on-disk inode.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00018" num="00018" class="claim">
      <div class="claim-text">18. An article of manufacture as in <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein the instructions further cause the processor to move atomically said file system on said storage system from said first consistent state to said second consistent state.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00019" num="00019" class="claim">
      <div class="claim-text">19. An article of manufacture as in <claim-ref idref="CLM-00018">claim 18</claim-ref>, wherein the instructions cause the processor to move atomically said file system on said storage system to said second consistent state by flushing said changes from said buffers to said storage system before updating said on-disk root inode with information from said incore root inode.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00020" num="00020" class="claim">
      <div class="claim-text">20. An article of manufacture as in <claim-ref idref="CLM-00019">claim 19</claim-ref>, wherein updating said on-disk root inode comprises updating said on-disk root inode and then a copy of said on-disk root inode such that if updating said on-disk root inode is interrupted, said copy of said on-disk root inode still points to said first consistent state of said file system.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00021" num="00021" class="claim">
      <div class="claim-text">21. An article of manufacture as in <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein the instructions further cause the processor to create a snapshot of said file system by copying only said on-disk root inode.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00022" num="00022" class="claim">
      <div class="claim-text">22. An article of manufacture as in <claim-ref idref="CLM-00021">claim 21</claim-ref>, wherein the instructions cause the processor to create said snapshot so that said snapshot and said file system share said first set of blocks on said storage system when said snapshot is created.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00023" num="00023" class="claim">
      <div class="claim-text">23. An article of manufacture as in <claim-ref idref="CLM-00017">claim 17</claim-ref>, wherein the instructions further cause the processor to create plural snapshots of said file system by copying only said on-disk root inode at different times.</div>
    </div>
    </div> <div class="claim-dependent"> <div id="CLM-00024" num="00024" class="claim">
      <div class="claim-text">24. An article of manufacture as in <claim-ref idref="CLM-00023">claim 23</claim-ref>, wherein the instructions, when executed by the processor, cause the processor to create each one of said plural snapshots so that each one of said snapshots and said file system share said first set of blocks on said storage system when each one of said plural snapshots is created.</div>
    </div>
  </div> </div></div></div><div class="patent-section patent-description-section"><div class="patent-section-header"><span class="patent-section-title">Description</span></div><div class="patent-text"><div mxw-id="PDES15864227" lang="EN" load-source="patent-office" class="description">
    <heading>CROSS-REFERENCE TO RELATED APPLICATION</heading> <p num="p-0002">This is a continuation of application Ser. No. 09/954,522, filed Sep. 11, 2001 (now U.S. Pat. No. 6,721,764), which is a continuation of application Ser. No. 09/153,094, filed Sep. 14, 1998 (now U.S. Pat. No. 6,289,356), which is a continuation of application Ser. No. 09/108,022, filed Jun. 30, 1998 (now U.S. Pat. No. 5,963,962), which is a continuation of application No. Ser. 08/454,921, filed May 31, 1995 (now U.S. Pat. No. 5,819,292), which is a continuation of application Ser. No. 08/071,643, filed Jun. 3, 1993 (now abandoned).</p>
    <heading>BACKGROUND OF THE INVENTION</heading> <p num="p-0003">1. Field of the Invention</p>
    <p num="p-0004">The present invention is related to the field of methods and apparatus for maintaining a consistent file system and for creating read-only copies of the file system.</p>
    <p num="p-0005">2. Background Art</p>
    <p num="p-0006">All file systems must maintain consistency in spite of system failure. A number of different consistency techniques have been used in the prior art for this purpose.</p>
    <p num="p-0007">One of the most difficult and time consuming issues in managing any file server is making backups of file data. Traditional solutions have been to copy the data to tape or other off-line media. With some file systems, the file server must be taken off-line during the backup process in order to ensure that the backup is completely consistent. A recent advance in backup is the ability to quickly clone (i.e., a prior art method for creating a read-only copy of the file system on disk) a file system, and perform a backup from the clone instead of from the active file system. With this type of file system, it allows the file server to remain on-line during the backup.</p>
    <p num="p-0008">File System Consistency</p>
    <p num="p-0009">A prior art file system is disclosed by Chutani, et al. in an article entitled <i>The Episode File System</i>, USENIX, Winter 1992, at pages 43-59. The article describes the Episode file system which is a file system using meta-data,(i.e., inode tables, directories, bitmaps, and indirect blocks). It can be used as a stand-alone or as a distributed file system. Episode supports a plurality of separate file system hierarchies. Episode refers to the plurality of file systems collectively as an aggregate. In particular, Episode provides a clone of each file system for slowly changing data.</p>
    <p num="p-0010">In Episode, each logical file system contains an anode table. An anode table is the equivalent of an inode table used in file systems such as the Berkeley Fast File System. It is a 252-byte structure. Anodes are used to store all user data as well as meta-data in the Episode file system. An anode describes the root directory of a file system including auxiliary files and directories. Each such file system in Episode is referred to as a fileset. All data within a fileset is locatable by iterating through the anode table and processing each file in turn. Episode creates a read-only copy of a file system, herein referred to as a clone, and shares data with the active file system using Copy-On-Write (COW) techniques.</p>
    <p num="p-0011">Episode uses a logging technique to recover a file system(s) after a system crashes. Logging ensures that the file system meta-data are consistent. A bitmap table contains information about whether each block in the file system is allocated or not. Also, the bitmap table indicates whether or not each block is logged. All meta-data updates are recorded in a log container that stores transaction log of the aggregate. The log is processed as a circular buffer of disk blocks. The transaction logging of Episode uses logging techniques originally developed for databases to ensure file system consistency. This technique uses carefully order writes and a recovery program that are supplemented by database techniques in the recovery program.</p>
    <p num="p-0012">Other prior art systems including JFS of IBM and VxFS of Veritas Corporation use various forms of transaction logging to speed the recover process, but still require a recovery process.</p>
    <p num="p-0013">Another prior art method is called the ordered write technique. It writes all disk blocks in a carefully determined order so that damage is minimized when a system failure occurs while performing a series of related writes. The prior art attempts to ensure that inconsistencies that occur are harmless. For instance, a few unused blocks or inodes being marked as allocated. The primary disadvantage of this technique is that the restrictions it places on disk order make it hard to achieve high performance.</p>
    <p num="p-0014">Yet another prior art system is an elaboration of the second prior art method referred to as an ordered write with recovery technique. In this method, inconsistencies can be potentially harmful. However, the order of writes is restricted so that inconsistencies can be found and fixed by a recovery program. Examples of this method include the original UNIX file system and Berkeley Fast File System (FFS). This technique does not reduce disk ordering sufficiently to eliminate the performance penalty of disk ordering. Another disadvantage is that the recovery process is time consuming. It typically is proportional to the size of the file system. Therefore, for example, recovering a 5 GB FFS file system requires an hour or more to perform.</p>
    <p num="p-0015">File System Clones</p>
    <p num="p-0016"> <figref idrefs="DRAWINGS">FIG. 1</figref> is a prior art diagram for the Episode file system illustrating the use of Copy-On-Write (COW) techniques for creating a fileset clone. Anode <b>110</b> comprises a first pointer <b>110</b>A having a COW bit that is set. Pointer <b>110</b>A references data block <b>114</b> directly. Anode <b>110</b> comprises a second pointer <b>110</b>B having a COW bit that is cleared. Pointer <b>110</b>B of anode references indirect block <b>112</b>. Indirect block <b>112</b> comprises a pointer <b>112</b>A that references data block <b>124</b> directly. The COW bit of pointer <b>112</b>A is set. Indirect block <b>112</b> comprises a second pointer <b>112</b>B that references data block <b>126</b>. The COW bit of pointer <b>112</b>B is cleared.</p>
    <p num="p-0017">A clone anode <b>120</b> comprises a first pointer <b>120</b>A that references data block <b>114</b>. The COW bit of pointer <b>120</b>A is cleared. The second pointer <b>120</b>B of clone anode <b>120</b> references indirect block <b>122</b>. The COW bit of pointer <b>120</b>B is cleared. In turn, indirect block <b>122</b> comprises a pointer <b>122</b>A that references data block <b>124</b>. The COW bit of pointer <b>122</b>A is cleared.</p>
    <p num="p-0018">As illustrated in <figref idrefs="DRAWINGS">FIG. 1</figref>, every direct pointer <b>110</b>A, <b>112</b>A-<b>112</b>B, <b>120</b>A, and <b>122</b>A and indirect pointer <b>110</b>B and <b>120</b>B in the Episode file system contains a COW bit. Blocks that have not been modified since the clone was created are contained in both the active file system and the clone, and have set (1) COW bits. The COW bit is cleared (0} when a block that is referenced to by the pointer has been modified and, therefore, is part of the active file system but not the clone.</p>
    <p num="p-0019">When a clone is created in Episode, the entire anode table is copied, along with all indirect blocks that the anodes reference. The new copy describes the clone, and the original copy continues to describe the active file system. In the original copy, the COW bits in all pointers are set to indicate that they point to the same data blocks as the clone. Thus, when inode <b>110</b> in <figref idrefs="DRAWINGS">FIG. 1</figref> was cloned, it was copied to clone anode <b>120</b>, and indirect block <b>112</b> was copied to clone indirect block <b>122</b>. In addition, COW bit <b>12</b>A was set to indicate that indirect blocks <b>112</b> and <b>122</b> both point to data block <b>124</b>. In <figref idrefs="DRAWINGS">FIG. 1</figref>, data block <b>124</b> has not been modified since the clone was created, so it is still referenced by pointers <b>112</b>A and <b>112</b>B, and the COW bit in <b>112</b>A is still set. Data block <b>126</b> is not part of the clone, and so pointer <b>112</b>B which references it does not have its COW bit set.</p>
    <p num="p-0020">When an Episode clone is created, every anode and every indirect block in the file system must be copied, which consumes many mega-bytes and takes a significant amount of time to write to disk.</p>
    <p num="p-0021">A fileset clone is a read-only copy of an active fileset wherein the active fileset is readable and writable. Clones are implemented using COW techniques, and share data blocks with an active fileset on a block-by-block basis. Episode implements cloning by copying each anode stored in a fileset. When initially cloned, both the writable anode of the active fileset and the cloned anode both point to the same data block(s). However, the disk addresses for direct and indirect blocks in the original anode are tagged as COW. Thus, an update to the writable fileset does not affect the clone. When a COW block is modified, a new block is allocated in the file system and updated with the modification. The COW flag in the pointer to this new block is cleared.</p>
    <p num="p-0022">The prior art Episode system creates clones that duplicate the entire inode file and all of the indirect blocks in the file system. Episode duplicates all inodes and indirect blocks so that it can set a Copy-On-Write (COW) bit in all pointers to blocks that are used by both the active file system and the clone. In Episode, it is important to identify these blocks so that new data written to the active file system does not overwrite old data that is part of the clone and, therefore, must not change.</p>
    <p num="p-0023">Creating a clone in the prior art can use up as much as 32 MB on a 1 GB disk. The prior art uses 256 MB of disk space on a 1 GB disk (for 4 KB blocks) to keep eight clones of the file system. Thus, the prior art cannot use large numbers of clones to prevent loss of data. Instead it used to facilitate backup of the file system onto an auxiliary storage means other than the disk drive, such as a tape backup device. Clones are used to backup a file system in a consistent state at the instant the clone is made. By cloning the file system, the clone can be backed up to the auxiliary storage means without shutting down the active file system, and thereby preventing users from using the file system. Thus, clones allow users to continue accessing an active file system while the file system, in a consistent state is backed up. Then the done is deleted once the backup is completed. Episode is not capable of supporting multiple clones since each pointer has only one COW bit. A single COW bit <b>30</b> is not able to distinguish more than one clone. For more than one clone, there is no second COW bit that can be set.</p>
    <p num="p-0024">A disadvantage of the prior art system for creating file system clones is that it involves duplicating all of the inodes and all of the indirect blocks in the file system. For a system with many small files, the inodes alone can consume a significant percentage of the total disk space in a file system. For example, a 1 GB file system that is filled with 4 KB files has 32 MB of inodes. Thus, creating an Episode clone consumes a significant amount of disk space, and generates large amounts (i.e., many megabytes) of disk traffic. As a result of these conditions, creating a clone of a file system takes a significant amount of time to complete.</p>
    <p num="p-0025">Another disadvantage of the prior art system is that it makes it difficult to create multiple clones of the same file system. The result of this is that clones tend to be used, one at a time, for short term operations such as backing up the file system to tape, and are then deleted.</p>
    <heading>SUMMARY OF THE INVENTION</heading> <p num="p-0026">The present invention provides a method for maintaining a file system in a consistent state and for creating read-only copies of a file system. Changes to the file system are tightly controlled to maintain the file system in a consistent state. The file system progresses from one self-consistent state to another self-consistent state. The set of self-consistent blocks on disk that is rooted by the root inode is referred to as a consistency point (CP). To implement consistency points, WAFL always writes new data to unallocated blocks on disk. It never overwrites existing data. A new consistency point occurs when the fsinfo block is updated by writing a new root inode for the inode file into it. Thus, as long as the root inode is not updated, the state of the file system represented on disk does not change.</p>
    <p num="p-0027">The present invention also creates snapshots, which are virtual read-only copies of the file system. A snapshot uses no disk space when it is initially created. It is designed so that many different snapshots can be created for the same file system. Unlike prior art file systems that create a clone by duplicating the entire inode file and all of the indirect blocks, the present invention duplicates only the inode that describes the inode file. Thus, the actual disk space required for a snapshot is only the 128 bytes used to store the duplicated inode. The 128 bytes of the present invention required for a snapshot is significantly less than the many megabytes used for a clone in the prior art.</p>
    <p num="p-0028">The present invention prevents new data written to the active file system from overwriting old data that is part of a snapshot(s). It is necessary that old data not be overwritten as long as it is part of a snapshot. This is accomplished by using a multi-bit free-block map. Most prior art file systems use a free block map having a single bit per block to indicate whether or not a block is allocated. The present invention uses a block map having 32-bit entries. A first bit indicates whether a block is used by the active file system, and 20 remaining bits are used for up to 20 snapshots, however, some bits of the 31 bits may be used for other purposes.</p>
    <description-of-drawings> <heading>BRIEF DESCRIPTION OF THE DRAWINGS</heading> <p num="p-0029"> <figref idrefs="DRAWINGS">FIG. 1</figref> is a block diagram of a prior art clone of a file system.</p>
      <p num="p-0030"> <figref idrefs="DRAWINGS">FIG. 2</figref> is a diagram illustrating a list of inodes having dirty buffers.</p>
      <p num="p-0031"> <figref idrefs="DRAWINGS">FIG. 3</figref> is a diagram illustrating an on-disk inode of WAFL.</p>
      <p num="p-0032"> <figref idrefs="DRAWINGS">FIGS. 4A-4D</figref> are diagrams illustrating on-disk inodes of WAFL having different levels of indirection.</p>
      <p num="p-0033"> <figref idrefs="DRAWINGS">FIG. 5</figref> is a flow diagram illustrating the method for generating a consistency point.</p>
      <p num="p-0034"> <figref idrefs="DRAWINGS">FIG. 6</figref> is a flow diagram illustrating step <b>530</b> of <figref idrefs="DRAWINGS">FIG. 5</figref> for generating a consistency point.</p>
      <p num="p-0035"> <figref idrefs="DRAWINGS">FIG. 7</figref> is a flow diagram illustrating step <b>530</b> of <figref idrefs="DRAWINGS">FIG. 5</figref> for creating a snapshot.</p>
      <p num="p-0036"> <figref idrefs="DRAWINGS">FIG. 8</figref> is a diagram illustrating an incore inode of WAFL according to the present invention.</p>
      <p num="p-0037"> <figref idrefs="DRAWINGS">FIGS. 9A-9D</figref> are diagrams illustrating incore inodes of WAFL having different levels of indirection according to the present invention.</p>
      <p num="p-0038"> <figref idrefs="DRAWINGS">FIG. 10</figref> is a diagram illustrating an incore inode <b>1020</b> for a file.</p>
      <p num="p-0039"> <figref idrefs="DRAWINGS">FIGS. 11A-11D</figref> are diagrams illustrating a block map (blkmap) file according to the present invention.</p>
      <p num="p-0040"> <figref idrefs="DRAWINGS">FIG. 12</figref> is a diagram illustrating an inode file according to the present invention.</p>
      <p num="p-0041"> <figref idrefs="DRAWINGS">FIGS. 13A-13B</figref> are diagrams illustrating an inode map (inomap) file according to the present invention.</p>
      <p num="p-0042"> <figref idrefs="DRAWINGS">FIG. 14</figref> is a diagram illustrating a directory according to the present invention.</p>
      <p num="p-0043"> <figref idrefs="DRAWINGS">FIG. 15</figref> is a diagram illustrating a file system information (fsinfo) structure.</p>
      <p num="p-0044"> <figref idrefs="DRAWINGS">FIG. 16</figref> is a diagram illustrating the WAFL file system.</p>
      <p num="p-0045"> <figref idrefs="DRAWINGS">FIGS. 17A-17L</figref> are diagrams illustrating the generation of a consistency point.</p>
      <p num="p-0046"> <figref idrefs="DRAWINGS">FIGS. 18A-18C</figref> are diagrams illustrating generation of a snapshot.</p>
      <p num="p-0047"> <figref idrefs="DRAWINGS">FIG. 19</figref> is a diagram illustrating changes to an inode file.</p>
      <p num="p-0048"> <figref idrefs="DRAWINGS">FIG. 20</figref> (comprising <figref idrefs="DRAWINGS">FIGS. 20A</figref>, <b>20</b>B, and <b>20</b>C) is a diagram illustrating fsinfo blocks used for maintaining a file system in a consistent state.</p>
      <p num="p-0049"> <figref idrefs="DRAWINGS">FIGS. 21A-21F</figref> are detailed diagrams illustrating generations of a snapshot.</p>
      <p num="p-0050"> <figref idrefs="DRAWINGS">FIG. 22</figref> is a diagram illustrating an active WAFL file system having three snapshots that each reference a common file; and,</p>
      <p num="p-0051"> <figref idrefs="DRAWINGS">FIGS. 23A-23B</figref> are diagrams illustrating the updating of a time.</p>
    </description-of-drawings> <heading>DETAILED DESCRIPTION OF THE PRESENT INVENTION</heading> <p num="p-0052">A system for creating read-only copies of a file system is described. In the following description, numerous specific details, such as number and nature of disks, disk block sizes, etc., are described in detail in order to provide a more thorough description of the present invention. It will be apparent, however, to one skilled in the art, that the present invention may be practiced without these specific details. In other instances, well-known features have not been described in detail so as not to unnecessarily obscure the present invention.</p>
    <p num="p-0053">Write Anywhere File-system Layout</p>
    <p num="p-0054">The present invention uses a Write Anywhere File-System Layout (WAFL). This disk format system is block based (i.e., 4 KB blocks that have no fragments), uses inodes to describe its files, and includes directories that are simply specially formatted files. WAFL uses files to store meta-data that describes the layout of the file system. WAFL meta-data files include: an inode file, a block map (blkmap) file, and an inode map (inomap) file. The inode file contains the inode table for the file system. The blkmap file indicates which disk blocks are allocated. The inomap file indicates which inodes are allocated. On-disk and incore WAFL inode distinctions are discussed below.</p>
    <p num="p-0055">On-disk WAFL Inodes</p>
    <p num="p-0056">WAFL inodes are distinct from prior art inodes. Each on-disk WAFL inode points to 16 blocks having the same level of indirection. A block number is 4-bytes long. Use of block numbers having the same level of indirection in an inode better facilitates recursive processing of a file. <figref idrefs="DRAWINGS">FIG. 3</figref> is a block diagram illustrating an on-disk inode <b>310</b>. The on-disk inode <b>310</b> is comprised of standard inode information <b>310</b>A and 16 block number entries <b>310</b>B having the same level of indirection. The inode information <b>310</b>A comprises information about the owner of a file, permissions, file size, access time, etc. that are well-known to a person skilled in the art. On-disk inode <b>310</b> is unlike prior art inodes that comprise a plurality of block numbers having different levels of indirection. Keeping all block number entries <b>310</b>B in an inode <b>310</b> at the same level of indirection simplifies file system implementation.</p>
    <p num="p-0057">For a small file having a size of 64 bytes or less, data is stored directly in the inode itself instead of the 16 block numbers. <figref idrefs="DRAWINGS">FIG. 4A</figref> is a diagram illustrating a Level <b>0</b> inode <b>410</b> that is similar to inode <b>310</b> shown in FIG. <b>3</b>. However, inode <b>410</b> comprises 64-bytes of data <b>410</b>B instead of 16 block numbers <b>310</b>B. Therefore, disk blocks do not need to be allocated for very small files.</p>
    <p num="p-0058">For a file having a size of less than 64 KB, each of the 16 block numbers directly references a 4 KB data block. <figref idrefs="DRAWINGS">FIG. 4B</figref> is a diagram illustrating a Level <b>1</b> inode <b>310</b> comprising 16 block numbers <b>310</b>B. The block number entries <b>0</b>-<b>15</b> point to corresponding 4 KB data blocks <b>420</b>A-<b>420</b>C.</p>
    <p num="p-0059">For a file having a size that is greater than or equal to 64 KB and is less than 64 MB, each of the 16 block numbers references a single-indirect block. In turn, each 4 KB single-indirect block comprises <b>1024</b> block numbers that reference 4 KB data blocks. <figref idrefs="DRAWINGS">FIG. 4C</figref> is a diagram illustrating a Level <b>2</b> inode <b>310</b> comprising 16 block numbers <b>310</b>B that reference 16 single-indirect blocks <b>430</b>A-<b>430</b>C. As shown in <figref idrefs="DRAWINGS">FIG. 4C</figref>, block number entry <b>0</b> points to single-indirect block <b>430</b>A. Single-indirect block <b>430</b>A comprises <b>1024</b> block numbers that reference 4 KB data blocks <b>440</b>A-<b>440</b>C. Similarly, single-indirect blocks <b>430</b>B-<b>430</b>C can each address up to 1024 data blocks.</p>
    <p num="p-0060">For a file size greater than 64 MB, the 16 block numbers of the inode reference double-indirect blocks. Each 4 KB double-indirect block comprises 1024 block numbers pointing to corresponding single-indirect blocks. In turn, each single-indirect block comprises 1024 block numbers that point to 4 KB data blocks. Thus, up to 64 GB can be addressed. <figref idrefs="DRAWINGS">FIG. 4D</figref> is a diagram illustrating a Level <b>3</b> inode <b>310</b> comprising 16 block numbers <b>310</b>B wherein block number entries <b>0</b>, <b>1</b>, and 15 reference double-indirect blocks <b>470</b>A, <b>470</b>B, and <b>470</b>C, respectively. Double-indirect block <b>470</b>A comprises 1024 block number entries <b>0</b>-<b>1023</b> that point to 1024 single-indirect blocks <b>480</b>A-<b>480</b>B. Each single-indirect block <b>480</b>A-<b>480</b>B, in turn, references 1024 data blocks. As shown in <figref idrefs="DRAWINGS">FIG. 4D</figref>, single-indirect block <b>480</b>A references 1024 data blocks <b>490</b>A-<b>490</b>C and single-indirect block <b>480</b>B references 1024 data blocks <b>490</b>C-<b>490</b>F.</p>
    <p num="p-0061">Incore WAFL Inodes</p>
    <p num="p-0062"> <figref idrefs="DRAWINGS">FIG. 8</figref> is a block diagram illustrating an incore WAFL inode <b>820</b>. The incore inode <b>820</b> comprises the information of on-disk inode <b>310</b> (shown in FIG. <b>3</b>), a WAFL buffer data structure <b>820</b>A, and 16 buffer pointers <b>820</b>B. A WAFL incore inode has a size of 300 bytes. A WAFL buffer is an incore (in memory) 4 KB equivalent of the 4 KB blocks that are stored on disk. Each incore WAFL inode <b>820</b> points to 16 buffers having the same levels of indirection. A buffer pointer is 4-bytes long. Keeping all buffer pointers <b>820</b>B in an inode <b>820</b> at the same level of indirection simplifies file system implementation. Incore inode <b>820</b> also contains incore information <b>820</b>C comprising a dirty flag, an in-consistency point (IN_CP) flag, and pointers for a linked list. The dirty flag indicates that the inode itself has been modified or that it references buffers that have changed. The IN_CP flag is used to mark an inode as being in a consistency point (described below). The pointers for a linked list are described below.</p>
    <p num="p-0063"> <figref idrefs="DRAWINGS">FIG. 10</figref> is a diagram illustrating a file referenced by a WAFL inode <b>1010</b>. The file comprises indirect WAFL buffers <b>1020</b>-<b>1024</b> and direct WAFL buffers <b>1030</b>-<b>1034</b>. The WAFL in-core inode <b>1010</b> comprises standard inode information <b>1010</b>A (including a count of dirty buffers), a WAFL buffer data structure <b>1010</b>B, 16 buffer pointers <b>1010</b>C and a standard on-disk inode <b>1010</b>D. The incore WAFL inode <b>1010</b> has a size of approximately 300 bytes. The on-disk inode is 128 bytes in size. The WAFL buffer data structure <b>1010</b>B comprises two pointers where the first one references the 16 buffer pointers <b>1010</b>C and the second references the on-disk block numbers <b>1010</b>D.</p>
    <p num="p-0064">Each inode <b>1010</b> has a count of dirty buffers that it references. An inode <b>1010</b> can be put in the list of dirty inodes and/or the list of inodes that have dirty buffers. When all dirty buffers referenced by an inode are either scheduled to be written to disk or are written to disk, the count of dirty buffers to inode <b>1010</b> is set to zero. The inode <b>1010</b> is then requeued according to its flag (i.e., no dirty buffers). This inode <b>1010</b> is cleared before the next inode is processed. Further the flag of the inode indicating that it is in a consistency point is cleared. The inode <b>1010</b> itself is written to disk in a consistency point.</p>
    <p num="p-0065">The WAFL buffer structure is illustrated by indirect WAFL buffer <b>1020</b>. WAFL buffer <b>1020</b> comprises a WAFL buffer data structure <b>1020</b>A, a 4 KB buffer <b>1020</b>B comprising <b>1024</b> WAFL buffer pointers and a 4 KB buffer <b>1020</b>C comprising <b>1024</b> on-disk block numbers. The WAFL buffer data structure is 56 bytes in size and comprises 2 pointers. One pointer of WAFL buffer data structure <b>1020</b>A references 4 KB buffer <b>1020</b>B and a second pointer references buffer <b>1020</b>C. In <figref idrefs="DRAWINGS">FIG. 10</figref>, the 16 buffer pointers <b>1010</b>C of WAFL inode <b>1010</b> point to the 16 single-indirect WAFL buffers <b>1020</b>-<b>1024</b>. In turn, WAFL buffer <b>1020</b> references <b>1024</b> direct WAFL buffer structures <b>1030</b>-<b>1034</b>. WAFL buffer <b>1030</b> is representative direct WAFL buffers.</p>
    <p num="p-0066">Direct WAFL buffer <b>1030</b> comprises WAFL buffer data structure <b>1030</b>A and a 4 KB direct buffer <b>1030</b>B containing a cached version of a corresponding on-disk 4 KB data block. Direct WAFL buffer <b>1030</b> does not comprise a 4 KB buffer such as buffer <b>1020</b>C of indirect WAFL buffer <b>1020</b>. The second buffer pointer of WAFL buffer data structure <b>1030</b>A is zeroed, and therefore does not point to a second 4 KB buffer. This prevents inefficient use of memory because memory space would be assigned for an unused buffer otherwise.</p>
    <p num="p-0067">In the WAFL file system as shown in <figref idrefs="DRAWINGS">FIG. 10</figref>, a WAFL in-core inode structure <b>1010</b> references a tree of WAFL buffer structures <b>1020</b>-<b>1024</b> and <b>1030</b>-<b>1034</b>. It is similar to a tree of blocks on disk referenced by standard inodes comprising block numbers that pointing to indirect and/or direct blocks. Thus, WAFL inode <b>1010</b> contains not only the on-disk inode <b>1010</b>D comprising 16 volume block numbers, but also comprises 16 buffer pointers <b>1010</b>C pointing to WAFL buffer structures <b>1020</b>-<b>1024</b> and <b>1030</b>-<b>1034</b>. WAFL buffers <b>1030</b>-<b>1034</b> contain cached contents of blocks referenced by volume block numbers.</p>
    <p num="p-0068">The WAFL in-code inode <b>1010</b> contains 16 buffer pointers <b>1010</b>C. In turn, the 16 buffer pointers <b>1010</b>C are referenced by a WAFL buffer structure <b>1010</b>B that roots the tree of WAFL buffers <b>1020</b>-<b>1024</b> and <b>1030</b>-<b>1034</b>. Thus, each WAFL inode <b>1010</b> contains a WAFL buffer structure <b>1010</b>B that points to the 16 buffer pointers <b>1010</b>C in the inode <b>1010</b>. This facilitates algorithms for handling trees of buffers that are implemented recursively. If the 16 buffer pointers <b>1010</b>C in the inode <b>1010</b> were not represented by a WAFL buffer structure <b>1010</b>B, the recursive algorithms for operating on an entire tree of buffers <b>1020</b>-<b>1024</b> and <b>1030</b>-<b>1034</b> would be difficult to implement.</p>
    <p num="p-0069"> <figref idrefs="DRAWINGS">FIGS. 9A-9D</figref> are diagrams illustrating inodes having different levels of in-direction. In <figref idrefs="DRAWINGS">FIGS. 9A-9D</figref>, simplified indirect and direct WAFL buffers are illustrated to show indirection. However, it should be understood that the WAFL buffers of <figref idrefs="DRAWINGS">FIG. 9</figref> represent corresponding indirect and direct buffers of FIG. <b>10</b>. For a small file having a size of 64 bytes or less, data is stored directly in the inode itself instead of the 16 buffer pointers. <figref idrefs="DRAWINGS">FIG. 9A</figref> is a diagram illustrating a Level <b>0</b> inode <b>820</b> that is the same as inode <b>820</b> shown in <figref idrefs="DRAWINGS">FIG. 8</figref> except that inode <b>820</b> comprises 64-bytes of data <b>920</b>B instead of 16 buffer pointers <b>820</b>B. Therefore, additional buffers are not allocated for very small files.</p>
    <p num="p-0070">For a file having a size of less than 64 KB, each of the 16 buffer pointers directly references a 4 KB direct WAFL buffer. <figref idrefs="DRAWINGS">FIG. 9B</figref> is a diagram illustrating a Level I inode <b>820</b> comprising 16 buffer pointers <b>820</b>B. The buffer pointers PTR<b>0</b>-PTR<b>15</b> point to corresponding 4 KB direct WAFL buffers <b>922</b>A-<b>922</b>C.</p>
    <p num="p-0071">For a file having a size that is greater than or equal to 64 KB and is less than 64 MB, each of the 16 buffer pointers references a single-indirect WAFL buffer. In turn, each 4 KB single-indirect WAFL buffer comprises 1024 buffer pointers that reference 4 KB direct WAFL buffers. <figref idrefs="DRAWINGS">FIG. 9C</figref> is a diagram illustrating a Level <b>2</b> inode <b>820</b> comprising 16 buffer pointers <b>820</b>B that reference 16 single-indirect WAFL buffers <b>930</b>A-<b>930</b>C. As shown in <figref idrefs="DRAWINGS">FIG. 9C</figref>, buffer pointer PTRO points to single-indirect WAFL buffer <b>930</b>A.</p>
    <p num="h-0006">Single-indirect WAFL buffer <b>930</b>A comprises 1024 pointers that reference 4 KB direct WAFL buffers <b>940</b>A-<b>940</b>C. Similarly, single-indirect WAFL buffers <b>930</b>B-<b>930</b>C can each address up to 1024 direct WAFL buffers.</p>
    <p num="p-0072">For a file size greater than 64 MB, the 16 buffer pointers of the inode reference double-indirect WAFL buffers. Each 4 KB double-indirect WAFL buffer comprises 1024 pointers pointing to corresponding single-indirect WAFL buffers. In turn, each single-indirect WAFL buffer comprises 1024 pointers that point to 4 KB direct WAFL buffers. Thus, up to 64 GB can be addressed. <figref idrefs="DRAWINGS">FIG. 9D</figref> is a diagram illustrating a Level <b>3</b> inode <b>820</b> comprising 16 pointers <b>820</b>B wherein pointers PTRO, PTR<b>1</b>, and PTR<b>15</b> reference double-indirect WAFL buffers <b>970</b>A, <b>970</b>B, and <b>970</b>C, respectively.</p>
    <p num="p-0073">Double-indirect WAFL buffer <b>970</b>A comprises 1024 pointers that point to 1024 single-indirect WAFL buffers <b>980</b>A-<b>980</b>B. Each single-indirect WAFL buffer <b>980</b>A-<b>980</b>B, in turn, references 1024 direct WAFL buffers. As shown in <figref idrefs="DRAWINGS">FIG. 9D</figref>, single-indirect WAFL buffer <b>980</b>A references 1024 direct WAFL buffers <b>990</b>A-<b>990</b>C and single-indirect WAFL buffer <b>980</b>B references 1024 direct WAFL buffers <b>990</b>D-<b>990</b>F.</p>
    <p num="p-0074">Directories</p>
    <p num="p-0075">Directories in the WAFL system are stored in 4 KB blocks that are divided into two sections. <figref idrefs="DRAWINGS">FIG. 14</figref> is a diagram illustrating a directory block <b>1410</b> according to the present invention. Each directory block <b>1410</b> comprises a first section <b>1410</b>A comprising fixed length directory entry structures <b>1412</b>-<b>1414</b> and a second section <b>1410</b>B containing the actual directory names <b>1416</b>-<b>1418</b>. Each directory entry also contains a file id and a generation. This information identifies what file the entry references. This information is well-known in the art, and therefore is not illustrated in FIG. <b>14</b>. Each entry <b>1412</b>-<b>1414</b> in the first section <b>1410</b>A of the directory block has a pointer to its name in the second section <b>1410</b>B. Further, each entry <b>1412</b>-<b>1414</b> includes a hash value dependent upon its name in the second section <b>1410</b>B so that the name is examined only when a hash hit (a hash match) occurs. For example, entry <b>1412</b> of the first section <b>1410</b>A comprises a hash value <b>1412</b>A and a pointer <b>1412</b>B. The hash value <b>1412</b>A is a value dependent upon the directory name DIRECTORY_ABC stored in variable length entry <b>1416</b> of the second section <b>1410</b>B. Pointer <b>1412</b>B of entry <b>1410</b> points to the variable length entry <b>1416</b> of second section <b>1410</b>B. Using fixed length directory entries <b>1412</b>-<b>1414</b> in the first Section <b>1410</b>A speeds up the process of name lookup. A calculation is not required to find the next entry in a directory block <b>1410</b>. Further, keeping entries <b>1412</b>-<b>1414</b> in the first section small <b>1410</b>A improves the hit rate for file systems with a line-fill data cache.</p>
    <p num="p-0076">Meta-Data</p>
    <p num="p-0077">WAFL keeps information that describes a file system in files known as meta-data. Meta-data comprises an inode file, inomap file, and a blkmap file. WAFL stores its meta-data in files that may be written anywhere on a disk. Because all WAFL meta-data is kept in files, it can be written to any location just like any other file in the file system.</p>
    <p num="p-0078">A first meta-data file is the inode file that contains inodes describing, all other files in the file system. <figref idrefs="DRAWINGS">FIG. 12</figref> is a diagram illustrating an inode file <b>1210</b>. The inode file <b>1210</b> may be written anywhere on a disk unlike prior art systems that write inode tables to a fixed location on disk. The inode file <b>1210</b> contains an inode <b>1210</b>A-<b>1210</b>F for each file in the file system except for the inode file <b>1210</b> itself. The inode file <b>1210</b> is pointed to by an inode referred to as the root inode. The root inode is kept in a fixed location on disk referred to as the file system information (fsinfo) block described below. The inode file <b>1210</b> itself is stored in 4 KB blocks on disk (or 4 KB buffers in memory). <figref idrefs="DRAWINGS">FIG. 12</figref> illustrates that inodes <b>1210</b>A-<b>1210</b>C are stored in a 4 KB buffer <b>1220</b>. For on-disk inode sizes of 128 bytes, a 4 KB buffer (or block) comprises 32 inodes. The incore inode file <b>1210</b> is composed of WAFL buffers <b>1220</b>. When an incore inode (i.e., <b>820</b>) is loaded, the on-disk inode part of the incore inode <b>820</b> is copied from the buffer <b>1220</b> of the inode lie <b>1210</b>. The buffer data itself is loaded from disk. Writing data to disk is done in the reverse order. The incore inode <b>820</b>, which contains a copy of the ondisk inode, is copied to the corresponding buffer <b>1220</b> of the inode file <b>1210</b>. Then, the inode file <b>1210</b> is write-allocated, and the data stored in the buffer <b>1220</b> of the inode file <b>1210</b> is written to disk.</p>
    <p num="p-0079">Another meta-data file is the block map (blkmap) file. <figref idrefs="DRAWINGS">FIG. 11A</figref> is a diagram illustrating a blkmap file <b>1110</b>. The blkmap file <b>1110</b> contains a 32-bit entry <b>1110</b>A-<b>1110</b>D for each 4 KB block in the disk system. It also serves as a free-block map file. The blkmap file <b>1110</b> indicates whether or not a disk block has been allocated. <figref idrefs="DRAWINGS">FIG. 11B</figref> is a diagram of a block entry <b>1110</b>A of blkmap file <b>1110</b> (shown in FIG. <b>11</b>A). As shown in <figref idrefs="DRAWINGS">FIG. 11B</figref>, entry <b>1110</b>A is comprised of 32 bits (BITO-BIT<b>31</b>). Bit <b>0</b> (BITO) of entry <b>1110</b>A is the active file system bit (F5-BIT). The FS-bit of entry <b>1110</b>A indicates whether or not the corresponding block is part of the active file system. Bits <b>1</b>-<b>20</b> (BIT<b>1</b>-BIT<b>20</b>) of entry <b>1110</b>A are bits that indicate whether the block is part of a corresponding snapshot <b>1</b>-<b>20</b>. The next upper 10 bits (BIT<b>21</b>-BIT<b>30</b>) are reserved. Bit <b>31</b> (BIT<b>31</b>) is the consistency point bit (CP-BIT) of entry <b>1110</b>A.</p>
    <p num="p-0080">A block is available as a free block in the file system when all bits (BITO-BIT<b>31</b>) in the 32-bit entry <b>1110</b>A for the block are clear (reset to a value of 0). <figref idrefs="DRAWINGS">FIG. 11C</figref> is a diagram illustrating entry <b>1110</b>A of <figref idrefs="DRAWINGS">FIG. 11A</figref> indicating the disk block is free. Thus, the block referenced by entry <b>1110</b>A of blkmap file <b>1110</b> is free when bits <b>0</b>-<b>31</b> (BITO-BIT<b>31</b>) all have values of 0.</p>
    <p num="p-0081"> <figref idrefs="DRAWINGS">FIG. 11D</figref> is a diagram illustrating entry <b>1110</b>A of <figref idrefs="DRAWINGS">FIG. 11A</figref> indicating an allocated block in the active file system. When bit <b>0</b> (BITO), also referred to as the FS-bit, is set to a value of 1, the entry <b>1110</b>A of blkmap file <b>1110</b> indicates a block that is part of the active file system. Bits <b>1</b>-<b>20</b> (BIT<b>1</b>-BIT<b>20</b>) are used to indicate corresponding snapshots, if any, that reference the block. Snapshots are described in detail below. If bit <b>0</b> (BITO) is set to a value of 0, this does not necessarily indicate that the block is available for allocation. All the snapshot bits must also be zero for the block to be allocated. Bit <b>31</b> (BIT<b>31</b>) of entry <b>1110</b>A always has the same state as bit <b>0</b> (BITO) on disk, however, when loaded into memory bit <b>31</b> (BIT<b>31</b>) is used for bookkeeping as part of a consistency point.</p>
    <p num="p-0082">Another meta-data file is the inode map (inomap) file that serves as a free inode map. <figref idrefs="DRAWINGS">FIG. 13A</figref> is a diagram illustrating an inomap file <b>1310</b>. The inomap file <b>1310</b> contains an 8-bit entry <b>1310</b>A-<b>1310</b>C for each block in the inode file <b>1210</b> shown in FIG. <b>12</b>. Each entry <b>1310</b>A-<b>1310</b>C is a count of allocated inodes in the corresponding block of the inode file <b>1210</b>. <figref idrefs="DRAWINGS">FIG. 13A</figref> shows values of 32, 5, and 0 in entries <b>1310</b>A-<b>1310</b>C, respectively. The inode file <b>1210</b> must still be inspected to find which inodes in the block are free, but does not require large numbers of random blocks to be loaded into memory from disk. Since each 4 KB block <b>1220</b> of inode file <b>1210</b> holds 32 inodes, the 8-bit inomap entry <b>1310</b>A-<b>1310</b>C for each block of inode file <b>1210</b> can have values ranging from 0 to 32. When a block <b>1220</b> of an inode file <b>1210</b> has no inodes in use, the entry <b>1310</b>A-<b>1310</b>C for it in inomap file <b>1310</b> is 0. When all the inodes in the block <b>1220</b> inode file <b>1210</b> are in use, the entry <b>1310</b>A-<b>1310</b>C of the inomap file <b>1310</b> has a value of 32.</p>
    <p num="p-0083"> <figref idrefs="DRAWINGS">FIG. 13B</figref> is a diagram illustrating an inomap file <b>1350</b> that references the 4 KB blocks <b>1340</b>A-<b>1340</b>C of inode file <b>1340</b>. For example, inode file <b>1340</b> stores 37 inodes in three 4 KB blocks <b>1340</b>A-<b>1340</b>C. Blocks <b>1340</b>A-<b>1340</b>C of inode file <b>1340</b> contain 32, 5, and 0 used inodes, respectively. Entries <b>1350</b>A-<b>1350</b>C of blkmap file <b>1350</b> reference blocks <b>1340</b>A-<b>1340</b>C of inode file <b>1340</b>, respectively. Thus, the entries <b>1350</b>A-<b>1350</b>C of inomap file have values of 32, 5, and 0 for blocks <b>1340</b>A-<b>1340</b>C of inode file <b>1340</b>. In turn, entries <b>1350</b>A-<b>1350</b>C of momap file indicate 0, 27, and 32 free inodes in blocks <b>1340</b>A-<b>1340</b>C of inode file <b>1340</b>, respectively.</p>
    <p num="p-0084">Referring to <figref idrefs="DRAWINGS">FIG. 13</figref>, using a bitmap for the entries <b>1310</b>A-<b>1310</b>C of inomap file <b>1310</b> instead of counts is disadvantageous since it would require 4 bytes per entry <b>1310</b>A-<b>1310</b>C for block <b>1220</b> of the inode file <b>1210</b> (shown in <figref idrefs="DRAWINGS">FIG. 12</figref>) instead of one byte. Free inodes in the block(s) <b>1220</b> of the inode file <b>1210</b> do not need to be indicated in the inomap file <b>1310</b> because the inodes themselves contain that information.</p>
    <p num="p-0085"> <figref idrefs="DRAWINGS">FIG. 15</figref> is a diagram illustrating a file system information (fsinfo) structure <b>1510</b>. The root inode <b>1510</b>B of a file system is kept in a fixed location on disk so that it can be located during booting of the file system. The fsinfo block is not a meta-data file but is part of the WAFL system. The root inode <b>1510</b>B is an inode referencing the inode file <b>1210</b>. It is part of the file system information (fsinfo) structure <b>1510</b> that also contains information <b>1510</b>A including the number of blocks in the file system, the creation time of the file system, etc. The miscellaneous information <b>1510</b>A further comprises a checksum <b>1510</b>C (described below). Except for the root inode <b>1510</b>B itself, this information <b>1510</b>A can be kept in a meta-data file in an alternate embodiment. Two identical copies of the fsinfo structure <b>1510</b> are kept in fixed locations on disk.</p>
    <p num="p-0086"> <figref idrefs="DRAWINGS">FIG. 16</figref> is a diagram illustrating the WAFL file system <b>1670</b> in a consistent state on disk comprising two fsinfo blocks <b>1610</b> and <b>1612</b>, inode file <b>1620</b>, blkmap file <b>1630</b>, inomap file <b>1640</b>, root directory <b>1650</b>, and a typical file (or directory) <b>1660</b>. Inode file <b>1620</b> is comprised of a plurality of inodes <b>1620</b>A-<b>1620</b>D that reference other files <b>1630</b>-<b>1660</b> in the file system <b>1670</b>. Inode <b>1620</b>A of inode file <b>1620</b> references blkmap file <b>1630</b>. Inode <b>1620</b>B references inomap file <b>1640</b>. Inode <b>1620</b>C references root directory <b>1650</b>. Inode <b>1620</b>D references a typical file (or directory) <b>1660</b>. Thus, the inode file points to all files <b>1630</b>-<b>1660</b> in the file system <b>1670</b> except for fsinfo blocks <b>1610</b> and <b>1612</b>. Fsinfo blocks <b>1610</b> and <b>1612</b> each contain a copy <b>1610</b>B and <b>1612</b>B of the inode of the inode file <b>1620</b>, respectively. Because the root inode <b>1610</b>B and <b>1612</b>B of fsinfo blocks <b>1610</b> and <b>1612</b> describes the inode file <b>1620</b>, that in turn describes the rest of the files <b>1630</b>-<b>1660</b> in the file system <b>1670</b> including all meta-data files <b>1630</b>-<b>1640</b>, the root inode <b>1610</b>B and <b>1612</b>B is viewed as-the root of a tree of blocks. The WAFL system <b>1670</b> uses this tree structure for its update method (consistency point) and for implementing snapshots, both described below.</p>
    <p num="p-0087">List of Inodes Having Dirty Blocks</p>
    <p num="p-0088">WAFL in-core inodes (i.e., WAFL inode <b>1010</b> shown in <figref idrefs="DRAWINGS">FIG. 10</figref>) of the WAFL file system are maintained in different linked lists according to their status. Inodes that reference dirty blocks are kept in a dirty inode list as shown in FIG. <b>2</b>. Inodes containing valid data that is not dirty are kept in a separate list and inodes that have no valid data are kept in yet another, as is well-known in the art. The present invention utilizes a list of inodes having dirty data blocks that facilitates finding all of the inodes that need write allocations to be done.</p>
    <p num="p-0089"> <figref idrefs="DRAWINGS">FIG. 2</figref> is a diagram illustrating a list <b>210</b> of dirty inodes according to the present invention. The list <b>210</b> of dirty inodes comprises WAFL in-core inodes <b>220</b>-<b>1750</b>. As shown in <figref idrefs="DRAWINGS">FIG. 2</figref>, each WAFL in-core inode <b>220</b>-<b>250</b> comprises a pointer <b>220</b>A-<b>250</b>A, respectively, that points to another inode in the linked list. For example, WAFL inodes <b>220</b>-<b>250</b> are stored in memory at locations <b>2048</b>, <b>2152</b>, <b>2878</b>, <b>3448</b> and <b>3712</b>, respectively. Thus, pointer <b>220</b>A of inode <b>220</b> contains address <b>2152</b>. It points therefore to WAFL inode <b>222</b>. In turn, WAFL inode <b>222</b> points to WAFL inode <b>230</b> using address <b>2878</b>. WAFL inode <b>230</b> points to WAFL inode <b>240</b>. WAFL inode <b>240</b> points to inode <b>250</b>. The pointer <b>250</b>A of WAFL inode <b>250</b> contains a null value and therefore does not point to another inode. Thus, it is the last inode in the list <b>210</b> of dirty inodes. Each inode in the list <b>210</b> represents a file comprising a tree of buffers as depicted in FIG. <b>10</b>. At least one of the buffers referenced by each inode <b>220</b>-<b>250</b> is a dirty buffer. A dirty buffer contains modified data that must be written to a new disk location in the WAFL system. WAFL always writes dirty buffers to new locations on disk.</p>
    <p num="p-0090">Consistency Points</p>
    <p num="p-0091">The WAFL disk structure described so far is static. In the present invention, changes to the file system <b>1670</b> are tightly controlled to maintain the file system <b>1670</b> in a consistent state. The file system <b>1670</b> progresses from one self-consistent state to another self-consistent state. The set (or tree) of self-consistent blocks on disk that is rooted by the root inode <b>1510</b>B is referred to as a consistency point (CP). To implement consistency points, WAFL always writes new data to unallocated blocks on disk. It never overwrites existing data. Thus, as long as the root inode <b>1510</b>B is not updated, the state of the file system <b>1670</b> represented on disk does not change. However, for a file system <b>1670</b> to be useful, it must eventually refer to newly written data, therefore a new consistency point must be written.</p>
    <p num="p-0092">Referring to <figref idrefs="DRAWINGS">FIG. 16</figref>, a new consistency point is written by first flushing all file system blocks to new locations on disk (including the blocks in meta-data files such as the inode file <b>1620</b>, blkmap file <b>1630</b>, and inomap file <b>1640</b>). A new root inode <b>1610</b>B and <b>1612</b>B for the file system <b>1670</b> is then written to disk. With this method for atomically updating a file system, the on-disk file system is never in-consistent. The on-disk file system <b>1670</b> reflects an old consistency point up until the root inode <b>1610</b>B and <b>1612</b>B is written. Immediately after the root inode <b>1610</b>B and <b>1612</b>B is written to disk, the file system <b>1670</b> reflects a new consistency point. Data structures of the file system <b>1670</b> can be updated in any order, and there are no ordering constraints on disk writes except the one requirement that all blocks in the file system <b>1670</b> must be written to disk before the root inode <b>1610</b>B and <b>1612</b>B is updated.</p>
    <p num="p-0093">To convert to a new consistency point, the root inode <b>1610</b>B and <b>1612</b>B must be updated reliably and atomically. WAFL does this by keeping two identical copies of the fsinfo structure <b>1610</b> and <b>1612</b> containing the root inode <b>1610</b>B and <b>1612</b>B. During updating of the root inode <b>1610</b>B and <b>1612</b>B, a first copy of the fsinfo structure <b>1610</b> is written to disk, and then the second copy of the fsinfo structure <b>1612</b> is written. A checksum <b>1610</b>C and <b>1612</b>C in the fsinfo structure <b>1610</b> and <b>1612</b>, respectively, is used to detect the occurrence of a system crash that corrupts one of the copies of the fsinfo structure <b>1610</b> or <b>1612</b>, each containing a copy of the root inode, as it is being written to disk. Normally, the two fsinfo structures <b>1610</b> and <b>1612</b> are identical.</p>
    <p num="p-0094">Algorithm for Generating a Consistency Point</p>
    <p num="p-0095"> <figref idrefs="DRAWINGS">FIG. 5</figref> is a diagram illustrating the method of producing a consistency point. In step <b>510</b>, all dirty inodes (inodes that point to new blocks containing modified data) in the system are marked as being in the consistency point. Their contents, and only their contents, are written to disk. Only when those writes are complete are any writes from other inodes allowed to reach disk. Further, during the time dirty writes are occurring, no new modifications can be made to inodes that have their consistency point flag set.</p>
    <p num="p-0096">In addition to setting the consistency point flag for all dirty inodes that are part of the consistency point, a global consistency point flag is set so that user-requested changes behave in a tightly controlled manner. Once the global consistency point flag is set, user-requested changes are not allowed to affect inodes that have their consistency point flag set. Further, only inodes having a consistency point flag that is set are allocated disk space for their dirty blocks. Consequently, the state of the file system will be flushed to disk exactly as it was when the consistency point began.</p>
    <p num="p-0097">In step <b>520</b>, regular files are flushed to disk. Flushing regular files comprises the steps of allocating disk space for dirty blocks in the regular files, and writing the corresponding WAFL buffers to disk. The inodes themselves are then flushed (copied) to the inode file. All inodes that need to be written are in either the list of inodes having dirty buffers or the list of inodes that are dirty but do not have dirty buffers. When step <b>520</b> is completed, there are no more ordinary inodes with the consistency point flag set, and all incoming I/O requests succeed unless the requests use buffers that are still locked up for disk I/O operations.</p>
    <p num="p-0098">In step <b>530</b>, special files are flushed to disk. Flushing special files comprises the steps of allocating disk space for dirty blocks in the two special files: the inode file and the blkmap file, updating the consistency bit (CP-bit) to match the active file system bit (FS-bit) for each entry in the blkmap file, and then writing the blocks to disk. Write allocating the inode file and the blkmap is complicated because the process of write allocating them changes the files themselves. Thus, in step <b>530</b> writes are disabled while changing these files to prevent important blocks from locking up in disk I/O operations before the changes are completed.</p>
    <p num="p-0099">Also, in step <b>530</b>, the creation and deletion of snapshots, described below, are performed because it is the only point in time when the file system, except for the fsinfo block, is completely self consistent and about to be written to disk. A snapshot is deleted from the file system before a new one is created so that the same snapshot inode can be used in one pass.</p>
    <p num="p-0100"> <figref idrefs="DRAWINGS">FIG. 6</figref> is a flow diagram illustrating the steps that step <b>530</b> comprises. Step <b>530</b> allocates disk space for the blkmap file and the inode file and copies the active FS-bit into the CP-bit for each entry in the blkmap file. In step <b>610</b>, the inode for the blkmap file is pre-flushed to the inode file. This ensures that the block in the inode file that contains the inode of the blkmap file is dirty so that step <b>620</b> allocates disk space for it.</p>
    <p num="p-0101">In step <b>620</b>, disk space is allocated for all dirty blocks in the inode and blkmap files. The dirty blocks include the block in the inode file containing the inode of the blkmap file.</p>
    <p num="p-0102">In step <b>630</b>, the inode for the blkmap file is flushed again, however this time the actual inode is written to the pre-flushed block in the inode file. Step <b>610</b> has already dirtied the block of the inode file that contains the inode of the blkmap file. Thus, another write-allocate, as in step <b>620</b>, does not need to be scheduled.</p>
    <p num="p-0103">In step <b>640</b>, the entries for each block in the blkmap file are updated. Each entry is updated by copying the active FS-bit to the CP-bit (i.e., copying bit <b>0</b> into bit <b>31</b>) for all entries in dirty blocks in the blkmap file.</p>
    <p num="p-0104">In step <b>650</b>, all dirty blocks in the blkmap and inode files are written to disk. Only entries in dirty blocks of the blkmap file need to have the active file system bit (FS-bit) copied to the consistency point bit (CP-bit) in step <b>640</b>. Immediately after a consistency point, all blkmap entries have same value for both the active FS-bit and CP-bit. As time progresses, some active FS-bits of blkmap file entries for the file system are either cleared or set. The blocks of the blkmap file containing the changed FS-bits are accordingly marked dirty. During the following consistency point, blocks that are clean do not need to be re-copied. The clean blocks are not copied because they were not dirty at the previous consistency point and nothing in the blocks has changed since then. Thus, as long as the file system is initially created with the active FS-bit and the CP-bit having the same value in all blkmap entries, only entries with dirty blocks need to be up-dated at each consistency point.</p>
    <p num="p-0105">Referring to <figref idrefs="DRAWINGS">FIG. 5</figref>, in step <b>540</b>, the file system information (fsinfo) block is first updated and then flushed to disk. The fsinfo block is updated by writing a new root inode for the inode file into it. The fsinfo block is written twice. It is first written to one location and then to a second location. The two writes are performed so that when a system crash occurs during either write, a self-consistent file system exists on disk. Therefore, either the new consistency point is available if the system crashed while writing the second fsinfo block or the previous consistency point (on disk before the recent consistency point began) is available if the first fsinfo block failed. When the file system is restarted after a system failure, the highest generation count for a consistency point in the fsinfo blocks having a correct checksum value is used. This is described in detail below.</p>
    <p num="p-0106">In step <b>550</b>, the consistency point is completed. This requires that any dirty inodes that were delayed because they were not part of the consistency point be requeued. Any inodes that had their state change during the consistency point are in the consistency point wait (CP_WAIT) queue. The CP_WAIT queue holds inodes that changed before step <b>540</b> completed, but after step <b>510</b> when the consistency point started. Once the consistency point is completed, the inodes in the CP_WAIT queue are re-queued accordingly in the regular list of inodes with dirty buffers and list of dirty inodes without dirty buffers.</p>
    <p num="p-0107">Single Ordering Constraint of Consistency Point</p>
    <p num="p-0108">The present invention, as illustrated in <figref idrefs="DRAWINGS">FIGS. 20A-20C</figref>, has a single ordering constraint. The single ordering constraint is that the fsinfo block <b>1810</b> is written to disk only after all the other blocks are written to disk. The writing of the fsinfo block <b>1810</b> is atomic, otherwise the entire file system <b>1830</b> could be lost. Thus, the WAFL file system requires the fsinfo block <b>1810</b> to be written at once and not be in an inconsistent state. As illustrated in <figref idrefs="DRAWINGS">FIG. 15</figref>, each of the fsinfo blocks <b>1810</b> (<b>1510</b>) contains a checksum <b>1510</b>C and a generation count <b>1510</b>D.</p>
    <p num="p-0109"> <figref idrefs="DRAWINGS">FIG. 20A</figref> illustrates the updating of the generation count <b>1810</b>D and <b>1870</b>D of fsinfo blocks <b>1810</b> and <b>1870</b>. Each time a consistency point (or snap-shot) is performed, the generation count of the fsinfo block is updated. <figref idrefs="DRAWINGS">FIG. 20A</figref> illustrates two fsinfo blocks <b>1810</b> and <b>1870</b> having generation counts <b>1810</b>D and <b>1870</b>D, respectively, that have the same value of N indicating a consistency point for the file system. Both fsinfo blocks reference the previous consistency point (old file system on disk) <b>1830</b>. A new version of the file system exists on disk and is referred to as new consistency point <b>1831</b>. The generation count is incremented every consistency point.</p>
    <p num="p-0110">In <figref idrefs="DRAWINGS">FIG. 20B</figref>, the generation count <b>1810</b>D of the first fsinfo block <b>1810</b> is updated and given a value of N+1. It is then written to disk. <figref idrefs="DRAWINGS">FIG. 20B</figref> illustrates a value of N+1 for generation count <b>1810</b>D of fsinfo block <b>1810</b> whereas the generation count <b>1870</b>D of the second fsinfo block <b>1870</b> has a value of N. Fsinfo block <b>1810</b> references new consistency point <b>1831</b> whereas fsinfo block <b>1870</b> references old consistency point <b>1830</b>. Next, the generation count <b>1870</b>D of fsinfo block <b>1870</b> is updated and written to disk as illustrated in FIG. <b>20</b>C. In <figref idrefs="DRAWINGS">FIG. 20C</figref>, the generation count <b>1870</b>D of fsinfo block <b>1870</b> has a value of N+1. Therefore the two fsinfo blocks <b>1810</b> and <b>1870</b> have the same generation count value of N+1.</p>
    <p num="p-0111">When a system crash occurs between fsinfo block updates, each copy of the fsinfo block <b>1810</b> and <b>1870</b> will have a self consistent checksum (not shown in the diagram), but one of the generation numbers <b>1810</b>D or <b>1870</b>D will have a higher value. A system crash occurs when the file system is in the state illustrated in FIG. <b>20</b>B. For example, in the preferred embodiment of the present invention as illustrated in <figref idrefs="DRAWINGS">FIG. 20B</figref>, the generation count <b>1810</b>D of fsinfo block <b>1810</b> is updated before the second fsinfo block <b>1870</b>. Therefore, the generation count <b>1810</b>D (value of one) is greater than the generation count <b>1870</b>D of fsinfo block <b>1870</b>. Because the generation count of the first fsinfo block <b>1810</b> is higher, it is selected for recovering the file system after a system crash. This is done because the first fsinfo block <b>1810</b> contains more current data as indicated by its generation count <b>1810</b>D. For the case when the first fsinfo block is corrupted because the system crashes while it is being updated, the other copy <b>1870</b> of the fsinfo block is used to recover the file system <b>1830</b> into a consistent state.</p>
    <p num="p-0112">It is not possible for both fsinfo blocks <b>1810</b> and <b>1870</b> to be updated at the same time in the present invention. Therefore, at least one good copy of the fsinfo block <b>1810</b> and <b>1870</b> exists in the file system. This allows the file system to always be recovered into a consistent state.</p>
    <p num="p-0113">WAFL does not require special recovery procedures. This is unlike prior art systems that use logging, ordered writes, and mostly ordered writes with recovery. This is because only data corruption, which RAID protects against, or software can corrupt a WAFL file system. To avoid losing data when the system fails, WAFL may keep a non-volatile transaction log of all operations that have occurred since the most recent consistency point. This log is completely independent of the WAFL disk format and is required only to prevent operations from being lost during a system crash. However, it is not required to maintain consistency of the file system.</p>
    <p num="p-0114">Generating a Consistency Point</p>
    <p num="p-0115">As described above, changes to the WAFL file system are tightly controlled to maintain the file system in a consistent state. <figref idrefs="DRAWINGS">FIGS. 17A-17H</figref> illustrate the generation of a consistency point for a WAFL file system. The generation of a consistency point is described with reference to <figref idrefs="DRAWINGS">FIGS. 5 and 6</figref>.</p>
    <p num="p-0116">In <figref idrefs="DRAWINGS">FIGS. 17A-17L</figref>, buffers that have not been modified do not have asterisks beside them. Therefore, buffers contain the same data as corresponding on-disk blocks. Thus, a block may be loaded into memory but it has not changed with respect to its on disk version. A buffer with a single asterisk (*) beside it indicates a dirty buffer in memory (its data is modified). A buffer with a double asterisk (**) beside it indicates a dirty buffer that has been allocated disk space. Finally, a buffer with a triple asterisk (***) is a dirty buffer that is written into a new block on disk. This convention for denoting the state of buffers is also used with respect to <figref idrefs="DRAWINGS">FIGS. 21A-21E</figref>.</p>
    <p num="p-0117"> <figref idrefs="DRAWINGS">FIG. 17A</figref> illustrates a list <b>2390</b> of inodes with dirty buffers comprising inodes <b>2306</b>A and <b>2306</b>B. Inodes <b>2306</b>A and <b>2306</b>B reference trees of buffers where at least one buffer of each tree has been modified. Initially, the consistency point flags <b>2391</b> and <b>2392</b> of inodes <b>2306</b>A and <b>2306</b>B are cleared (0). While a list <b>2390</b> of inodes with dirty buffers is illustrated for the present system, it should be obvious to a person skilled in the art that other lists of inodes may exist in memory. For instance, a list of inodes that are dirty but do not have dirty buffers is maintained in memory. These inodes must also be marked as being in the consistency point. They must be flushed to disk also to write the dirty contents of the inode file to disk even though the dirty inodes do not reference dirty blocks. This is done in step <b>520</b> of FIG. <b>5</b>.</p>
    <p num="p-0118"> <figref idrefs="DRAWINGS">FIG. 17B</figref> is a diagram illustrating a WAFL file system of a previous consistency point comprising fsinfo block <b>2302</b>, inode file <b>2346</b>, blkmap file <b>2344</b> and files <b>2340</b> and <b>2342</b>. File <b>2340</b> comprises blocks <b>2310</b>-<b>2314</b> containing data A, B, and C, respectively. File <b>2342</b> comprises data blocks <b>2316</b>-<b>2320</b> comprising data D, E, and F, respectively. Blkmap file <b>2344</b> comprises block <b>2324</b>. The inode file <b>2346</b> comprises two 4 KB blocks <b>2304</b> and <b>2306</b>. The second block <b>2306</b> comprises inodes <b>2306</b>A-<b>2306</b>C that reference file <b>2340</b>, file <b>2342</b>, and blkmap file <b>2344</b>, respectively. This is illustrated in block <b>2306</b> by listing the file number in the inode. Fsinfo block <b>2302</b> comprises the root inode. The root inode references blocks <b>2304</b> and <b>2306</b> of inode file <b>2346</b>. Thus, <figref idrefs="DRAWINGS">FIG. 17B</figref> illustrates a tree of buffers in a file system rooted by the fsinfo block <b>2302</b> containing the root inode.</p>
    <p num="p-0119"> <figref idrefs="DRAWINGS">FIG. 17C</figref> is a diagram illustrating two modified buffers for blocks <b>2314</b> and <b>2322</b> in memory. The active file system is modified so that the block <b>2314</b>containing data C is deleted from file <b>2340</b>. Also, the data F stored in block <b>2320</b> is modified to F-prime, and is stored in a buffer for disk block <b>2322</b>. It should be understood that the modified data contained in buffers for disk blocks <b>2314</b> and <b>2322</b> exists only in memory at this time. All other blocks in the active file system in <figref idrefs="DRAWINGS">FIG. 17C</figref> are not modified, and therefore have no asterisks beside them. However, some or all of these blocks may have corresponding clean buffers in memory.</p>
    <p num="p-0120"> <figref idrefs="DRAWINGS">FIG. 17D</figref> is a diagram illustrating the entries <b>2324</b>A-<b>2324</b>M of the blkmap file <b>2344</b> in memory. Entries <b>2324</b>A-<b>2324</b>M are contained in a buffer for 4 KB block <b>2324</b> of blkmap file <b>2344</b>. As described previously, BITO and BIT<b>31</b> are the FS-BIT and CP-BIT, respectively. The consistency point bit (CP-BIT) is set during a consistency point to ensure that the corresponding block is not modified once a consistency point has begun, but not finished. BIT<b>1</b> is the first snapshot bit (described below). Blkmap entries <b>2324</b>A and <b>2324</b>B illustrate that, as shown in <figref idrefs="DRAWINGS">FIG. 17B</figref>, the 4 KB blocks <b>2304</b> and <b>2306</b> of inode file <b>2346</b> are in the active file system (FS-BIT equal to 1) and in the consistency point (CP-BIT equal to 1). Similarly, the other blocks <b>2310</b>-<b>2312</b> and <b>2316</b>-<b>2320</b> and <b>2324</b> are in the active file system and in the consistency point. However, blocks <b>2308</b>, <b>2322</b>, and <b>2326</b>-<b>2328</b> are neither in the active file system nor in the consistency point (as indicated by BITO and BIT<b>31</b>, respectively). The entry for deleted block <b>2314</b> has a value of 0 in the FS-BIT indicating that it has been removed from the active file system.</p>
    <p num="p-0121">In step <b>510</b> of <figref idrefs="DRAWINGS">FIG. 5</figref>, all dirty inodes in the system are marked as being in the consistency point. Dirty inodes include both inodes that are dirty and inodes that reference dirty buffers. <figref idrefs="DRAWINGS">FIG. 17I</figref> illustrates a list of inodes with dirty buffers where the consistency point flags <b>2391</b> and <b>2392</b> of inodes <b>2306</b>A and <b>2306</b>B are set (1). Inode <b>2306</b>A references block <b>2314</b> containing data C of file <b>2340</b> which is to be deleted from the active file system. Inode <b>2306</b>B of block <b>2306</b> ot inode file <b>2346</b> references file <b>2342</b>. Block <b>2320</b> containing data F has been modified and a new block containing data F must be allocated. This is illustrated in FIG. <b>17</b>E.</p>
    <p num="p-0122">In step <b>520</b>, regular files are flushed to disk. Thus, block <b>2322</b> is allocated disk space. Block <b>2314</b> of file <b>2340</b> is to be deleted, therefore nothing occurs to this block until the consistency point is subsequently completed. Block <b>2322</b> is written to disk in step <b>520</b>. This is illustrated in <figref idrefs="DRAWINGS">FIG. 17F</figref> where buffers for blocks <b>2322</b> and <b>2314</b> have been written to disk (marked by ***). The intermediate allocation of disk space (**) is not shown. The incore copies of inodes <b>2308</b>A and <b>2308</b>B of block <b>2308</b> of inode file <b>2346</b> are copied to the inode file. The modified data exists in memory only, and the buffer <b>2308</b> is marked dirty. The in-consistency point flags <b>2391</b> and <b>2392</b> of inodes <b>2306</b>A and <b>2306</b>B are then cleared (0) as illustrated in FIG. <b>17</b>A. This releases the inodes for use by other processes. Inode <b>2308</b>A of block <b>2308</b> references blocks <b>2310</b> and <b>2312</b> of file <b>2346</b>. Inode <b>2308</b>B references blocks <b>2316</b>, <b>2318</b>, <b>2322</b> for file <b>2342</b>. As illustrated in <figref idrefs="DRAWINGS">FIG. 17F</figref>, disk space is allocated for direct block <b>2322</b> for file <b>2342</b> and that block is written to disk. However, the file system itself has not been updated. Thus, the file system remains in a consistent state.</p>
    <p num="p-0123">In step <b>530</b>, the blkmap file <b>2344</b> is flushed to disk. This is illustrated in <figref idrefs="DRAWINGS">FIG. 17G</figref> where the blkmap file <b>2344</b> is indicated as being dirty by the asterisk.</p>
    <p num="p-0124">In step <b>610</b> of <figref idrefs="DRAWINGS">FIG. 6</figref>, the inode for the blkmap file is pre-flushed to the inode file as illustrated in FIG. <b>17</b>H. Inode <b>2308</b>C has been flushed to block <b>230</b>B of inode file <b>2346</b>. However, inode <b>2308</b>C still references block <b>2324</b>. In step <b>620</b>, disk space is allocated for blkmap file <b>2344</b> and inode file <b>2346</b>. Block <b>2308</b> is allocated for inode file <b>2346</b> and block <b>2326</b> is allocated for blkmap file <b>2344</b>. As described above, block <b>2308</b> of inode file <b>2346</b> contains a pre-flushed inode <b>2308</b>C for blkmap file <b>2344</b>. In step <b>630</b>, the inode for the blkmap file <b>2344</b> is written to the pre-flushed block <b>2308</b>C in inode <b>2346</b>. Thus, incore inode <b>2308</b>C is updated to reference block <b>2324</b> in step <b>620</b>, and is copied into the buffer in memory containing block <b>2306</b> that is to be written to block <b>2308</b>. This is illustrated in <figref idrefs="DRAWINGS">FIG. 17H</figref> where inode <b>2308</b>C references block <b>2326</b>.</p>
    <p num="p-0125">In step <b>640</b>, the entries <b>2326</b>A-<b>2326</b>L for each block <b>2304</b>-<b>2326</b> in the blkmap file <b>2344</b> are updated in FIG. <b>17</b>J. Blocks that have not changed since the consistency point began in <figref idrefs="DRAWINGS">FIG. 17B</figref> have the same values in their entries. The entries are updated by copying BITO (FS-bit) to the consistency point bit (BIT<b>31</b>). Block <b>2306</b> is not part of the active file system, therefore BITO is equal to zero (BITO was turned off in step <b>620</b> when block <b>2308</b> was allocated to hold the new data for that part of the inode file). This is illustrated in <figref idrefs="DRAWINGS">FIG. 17J</figref> for entry <b>2326</b>B. Similarly, entry <b>2326</b>F for block <b>2314</b> of file <b>2340</b> has BITO and BIT<b>31</b> equal to zero. Block <b>2320</b> of file <b>2342</b> and block <b>2324</b> of blkmap file <b>2344</b> are handled similarly as shown in entries <b>2361</b> and <b>2326</b>K, respectively. In step <b>650</b>, dirty block <b>2308</b> of inode file <b>2346</b> and dirty block <b>2326</b> of blkmap file <b>2344</b> are written to disk. This is indicated in <figref idrefs="DRAWINGS">FIG. 17K</figref> by a triple asterisk (***) beside blocks <b>2308</b> and <b>2326</b>.</p>
    <p num="p-0126">Referring to <figref idrefs="DRAWINGS">FIG. 5</figref>, in step <b>540</b>, the file system information block <b>2302</b> is flushed to disk, this is performed twice. Thus, fsinfo block <b>2302</b> is dirtied and then written to disk (indicated by a triple asterisk) in FIG. <b>17</b>L. In <figref idrefs="DRAWINGS">FIG. 17L</figref>, a single fsinfo block <b>2302</b> is illustrated. As shown in the diagram, fsinfo block <b>2302</b> now references block <b>2304</b> and <b>2308</b> of the inode file <b>2346</b>. In <figref idrefs="DRAWINGS">FIG. 17L</figref>, block <b>2306</b> is no longer part of the inode file <b>2346</b> in the active file system. Similarly, file <b>2340</b> referenced by inode <b>2308</b>A of inode file <b>2346</b> comprises blocks <b>2310</b> and <b>2312</b>. Block <b>2314</b> is no longer part of file <b>2340</b> in this consistency point. File <b>2342</b> comprises blocks <b>2316</b>, <b>2318</b>, and <b>2322</b> in the new consistency point whereas block <b>2320</b> is not part of file <b>2342</b>. Further, block <b>2308</b> of inode file <b>2346</b> references a new blkmap file <b>2344</b> comprising block <b>2326</b>.</p>
    <p num="p-0127">As shown in <figref idrefs="DRAWINGS">FIG. 17L</figref>, in a consistency point, the active file system is updated by copying the mode of the inode file <b>2346</b> into fsinfo block <b>2302</b>. However, the blocks <b>2314</b>, <b>2320</b>, <b>2324</b>, and <b>2306</b> of the previous consistency point remain on disk. These blocks are never overwritten when updating the file system to ensure that both the old consistency point <b>1830</b> and the new consistency point <b>1831</b> exist on disk in <figref idrefs="DRAWINGS">FIG. 20</figref> during step <b>540</b>.</p>
    <p num="p-0128">Snapshots</p>
    <p num="p-0129">The WAFL system supports snapshots. A snapshot is a read-only copy of an entire file system at a given instant when the snapshot is created. A newly created snapshot refers to exactly the same disk blocks as the active file system does. Therefore, it is created in a small period of time and does not consume any additional disk space. Only as data blocks in the active file system are modified and written to new locations on disk does the snapshot begin to consume extra space.</p>
    <p num="p-0130">WAFL supports up to 20 different snapshots that are numbered 1 through 20. Thus, WAFL allows the creation of multiple clones of the same file system. Each snapshot is represented by a snapshot inode that is similar to the representation of the active file system by a root inode. Snapshots are created by duplicating the root data structure of the file system. In the preferred embodiment, the root data structure is the root inode. However, any data structure representative of an entire file system could be used. The snapshot inodes reside in a fixed location in the inode file. The limit of 20 snapshots is imposed by the size of the blkmap entries. WAFL requires two steps to create a new snapshot N: copy the root inode into the inode for snapshot N; and, copy bit <b>0</b> into bit N of each blkmap entry in the blkmap file. Bit <b>0</b> indicates the blocks that are referenced by the tree beneath the root inode.</p>
    <p num="p-0131">The result is a new file system tree rooted by snapshot inode N that references exactly the same disk blocks as the root inode. Setting a corresponding bit in the blkmap for each block in the snapshot prevents snapshot blocks from being freed even if the active file no longer uses the snapshot blocks. Because WAFL always writes new data to unused disk locations, the snapshot tree does not change even though the active file system changes. Because a newly created snapshot tree references exactly the same blocks as the root inode, it consumes no additional disk space. Over time, the snapshot references disk blocks that would otherwise have been freed. Thus, over time the snapshot and the active fife system share fewer and fewer blocks, and the space consumed by the snapshot increases. Snapshots can be deleted when they consume unacceptable numbers of disk blocks.</p>
    <p num="p-0132">The list of active snapshots along with the names of the snapshots is stored in a meta-data file called the snapshot directory. The disk state is updated as described above. As with all other changes, the update occurs by automatically advancing from one consistency point to another. Modified blocks are written to unused locations on the disk after which a new root inode describing the updated file system is written.</p>
    <p num="p-0133">Overview of Snapshots</p>
    <p num="p-0134"> <figref idrefs="DRAWINGS">FIG. 18A</figref> is a diagram of the file system <b>1830</b>, before a snapshot is taken, where levels of indirection have been removed to provide a simpler overview of the WAFL file system. The file system <b>1830</b> represents the file system <b>1690</b> of FIG. <b>16</b>. The file system <b>1830</b> is comprised of blocks <b>1812</b>-<b>1820</b>. The inode of the inode file is contained in fsinfo block <b>1810</b>. While a single copy of the fsinfo block <b>1810</b> is shown in <figref idrefs="DRAWINGS">FIG. 18A</figref>, it should be understood that a second copy of fsinfo block exists on disk. The inode <b>1810</b>A contained in the fsinfo block <b>1810</b> comprises 16 pointers that point to 16 blocks having the same level of indirection. The blocks <b>1812</b>-<b>1820</b> in <figref idrefs="DRAWINGS">FIG. 18A</figref> represent all blocks in the file system <b>1830</b> including direct blocks, indirect blocks, etc. Though only five blocks <b>1812</b>-<b>1820</b> are shown, each block may point to other blocks.</p>
    <p num="p-0135"> <figref idrefs="DRAWINGS">FIG. 18B</figref> is a diagram illustrating the creation of a snapshot. The snapshot is made for the entire file system <b>1830</b> by simply copying the inode <b>1810</b>A of the inode file that is stored in fsinfo block <b>1810</b> into the snapshot inode <b>1822</b>. By copying the inode <b>1810</b>A of the inode file, a new file of inodes is created representing the same file system as the active file system. Because the inode <b>1810</b>A of the inode file itself is copied, no other blocks <b>1812</b>-<b>1820</b> need to be duplicated. The copied inode or snapshot inode <b>1822</b>, is then copied into the inode file, which dirties a block in the inode file. For an inode file comprised of one or more levels of indirection, each indirect block is in turn dirtied. This process of dirtying blocks propagates through all the levels of indirection. Each 4 KB block in the inode file on disk contains 32 inodes where each inode is 128 bytes long.</p>
    <p num="p-0136">The new snapshot inode <b>1822</b> of <figref idrefs="DRAWINGS">FIG. 18B</figref> points back to the highest level of indirection blocks <b>1812</b>-<b>1820</b> referenced by the inode <b>1810</b>A of the inode file when the snapshot <b>1822</b> was taken. The inode file itself is a recursive structure because it contains snapshots of the file system <b>1830</b>. Each snapshot <b>1822</b> is a copy of the inode <b>1810</b>A of the inode file that is copied into the inode file.</p>
    <p num="p-0137"> <figref idrefs="DRAWINGS">FIG. 18C</figref> is a diagram illustrating the active file system <b>1830</b> and a snap-shot <b>1822</b> when a change to the active file system <b>1830</b> subsequently occurs after the snapshot <b>1822</b> is taken. As illustrated in the diagram, block <b>1818</b> comprising data D is modified after the snapshot was taken (in FIG. <b>18</b>B), and therefore a new block <b>1824</b> containing data Dprime is allocated for the active file system <b>1830</b>. Thus, the active file system <b>1830</b> comprises blocks <b>1812</b>-<b>1816</b> and <b>1820</b>-<b>1824</b> but does not contain block <b>1818</b> containing data D. However, block <b>1818</b> containing data D is not overwritten because the WAFL system does not overwrite blocks on disk. The block <b>1818</b> is protected against being over-written by a snapshot bit that is set in the blkmap entry for block <b>1818</b>. Therefore, the snapshot <b>1822</b> still points to the unmodified block <b>1818</b> as well as blocks <b>1812</b>-<b>1816</b> and <b>1820</b>. The present invention, as illustrated in <figref idrefs="DRAWINGS">FIGS. 18A-18C</figref>, is unlike prior art systems that create clones of a file system where a clone is a copy of all the blocks of an inode file on disk. Thus, the entire contents of the prior art inode files are duplicated requiring large amounts (MB) of disk space as well as requiring substantial time for disk I/O operations.</p>
    <p num="p-0138">As the active file system <b>1830</b> is modified in <figref idrefs="DRAWINGS">FIG. 18C</figref>, it uses more disk space because the file system comprising blocks <b>1812</b>-<b>1820</b> is not overwritten. In <figref idrefs="DRAWINGS">FIG. 18C</figref>, block <b>1818</b> is illustrated as a direct block. However, in an actual file system, block <b>1818</b> may be pointed to by indirect block as well. Thus, when block <b>1818</b> is modified and stored in a new disk location as block <b>1824</b>, the corresponding direct and indirect blocks are also copied and assigned to the active file system <b>1830</b>.</p>
    <p num="p-0139"> <figref idrefs="DRAWINGS">FIG. 19</figref> is a diagram illustrating the changes occurring in block <b>1824</b> of FIG. <b>18</b>C. Block <b>1824</b> of <figref idrefs="DRAWINGS">FIG. 18C</figref> is represented within dotted line <b>1824</b> in FIG. <b>19</b>. <figref idrefs="DRAWINGS">FIG. 19</figref> illustrates several levels of indirection for block <b>1824</b> of FIG. <b>18</b>C. The new block <b>1910</b> that is written to disk in <figref idrefs="DRAWINGS">FIG. 18C</figref> is labeled <b>1910</b> in FIG. <b>19</b>. Because block <b>1824</b> comprises a data block <b>1910</b> containing modified data that is referenced by double indirection, two other blocks <b>1918</b> and <b>1926</b> are also modified. The pointer <b>1924</b> of single-indirect block <b>1918</b> references new block <b>1910</b>, therefore block <b>1918</b> must also be written to disk in a new location. Similarly, pointer <b>1928</b> of indirect block <b>1926</b> is modified because it points to block <b>1918</b>. Therefore, as shown in <figref idrefs="DRAWINGS">FIG. 19</figref>, modifying a data block <b>1910</b> can cause several indirect blocks <b>1918</b> and <b>1926</b> to be modified as well. This requires blocks <b>1918</b> and <b>1926</b> to be written to disk in a new location as well.</p>
    <p num="p-0140">Because the direct and indirect blocks <b>1910</b>, <b>1918</b> and <b>1926</b> of data block <b>1824</b> of <figref idrefs="DRAWINGS">FIG. 18C</figref> have changed and been written to a new location, the inode in the inode file is written to a new block. The modified block of the inode file is allocated a new block on disk since data cannot be overwritten.</p>
    <p num="p-0141">As shown in <figref idrefs="DRAWINGS">FIG. 19</figref>, block <b>1910</b> is pointed to by indirect blocks <b>1926</b> and <b>1918</b>, respectively. Thus when block <b>1910</b> is modified and stored in a new disk location, the corresponding direct and indirect blocks are also copied and assigned to the active file system. Thus, a number of data structures must be updated. Changing direct block <b>1910</b> and indirection blocks <b>1918</b> and <b>1926</b> causes the blkmap file to be modified.</p>
    <p num="p-0142">The key data structures for snapshots are the blkmap entries where each entry has multiple bits for a snapshot. This enables a plurality of snapshots to be created. A snapshot is a picture of a tree of blocks that is the file system (<b>1830</b> of FIG. <b>18</b>). As long as new data is not written onto blocks of the snapshot, the file system represented by the snapshot is not changed. A snapshot is similar to a consistency point.</p>
    <p num="p-0143">The file system of the present invention is completely consistent as of the last time the fsinfo blocks <b>1810</b> and <b>1870</b> were written. Therefore, if power is interrupted to the system, upon restart the file system <b>1830</b> comes up in a consistent state. Because 8-32 MB of disk space are used in typical prior art clone of a 1 GB file system, clones are not conducive to consistency points or snapshots as is the present invention.</p>
    <p num="p-0144">Referring to <figref idrefs="DRAWINGS">FIG. 22</figref>, two previous snapshots <b>2110</b>A and <b>2110</b>B exist on disk. At the instant when a third snapshot is created, the root inode pointing to the active file system is copied into the inode entry <b>211</b>C for the third snapshot in the inode file <b>2110</b>. At the same time in the consistency point that goes through, a flag indicates that snapshot <b>3</b> has been created. The entire file system is processed by checking if BITO for each entry in the blkmap file is set (1) or cleared (0}. All the BITO values for each blkmap entry are copied into the plane for snapshot three. When completed, every active block <b>2110</b>-<b>2116</b> and <b>1207</b> in the file system is in the snapshot at the instant it is taken.</p>
    <p num="p-0145">Blocks that have existed on disk continuously for a given length of time are also present in corresponding snapshots <b>2110</b>-<b>2110</b>B preceding the third snapshot <b>2110</b>C. If a block has been in the file system for a long enough period of time, it is present in all the snapshots. Block <b>1207</b> is such a block. As shown in <figref idrefs="DRAWINGS">FIG. 22</figref>, block <b>1207</b> is referenced by inode <b>2210</b>G of the active inode file, and indirectly by snapshots <b>1</b>, <b>2</b> and <b>3</b>.</p>
    <p num="p-0146">The sequential order of snapshots does not necessarily represent a chronological sequence of file system copies. Each individual snapshot in a file system can be deleted at any given time, thereby making an entry available for subsequent use. When BITO of a blkmap entry that references the active file system is cleared (indicating the block has been deleted from the active file system), the block cannot be reused if any of the snapshot reference bits are set. This is because the block is part of a snapshot that is still in use. A block can only be reused when all the bits in the blkmap entry are set to zero.</p>
    <p num="p-0147">Algorithm for Generating a Snapshot</p>
    <p num="p-0148">Creating a snapshot is almost exactly like creating a regular consistency point as shown in FIG. <b>5</b>. In step <b>510</b>, all dirty inodes are marked as being in the consistency point. In step <b>520</b>, all regular files are flushed to disk. In step <b>530</b>, special files (i.e., the inode file and the blkmap file) are flushed to disk. In step <b>540</b>, the fsinfo blocks are flushed to disk. In step <b>550</b>, all inodes that were not in the consistency point are processed. <figref idrefs="DRAWINGS">FIG. 5</figref> is described above in detail. In fact, creating a snapshot is done as part of creating a consistency point. The primary difference between creating a snapshot and a consistency point is that all entries of the blkmap file have the active FS-bit copied into the snapshot bit. The snapshot bit represents the corresponding snapshot in order to protect the blocks in the snapshot from being overwritten. The creation and deletion of snapshot is performed in step <b>530</b> because that is the only point where the file system is completely self-consistent and about to go to disk.</p>
    <p num="p-0149">Different steps are performed in step <b>530</b> then illustrated in <figref idrefs="DRAWINGS">FIG. 6</figref> for a consistency point when a new snapshot is created. The steps are very similar to those for a regular consistency point. <figref idrefs="DRAWINGS">FIG. 7</figref> is a flow diagram illustrating the steps that step <b>530</b> comprises for creating a snapshot. As described above, step <b>530</b> allocates disk space for the blkmap file and the inode file and copies the active FS-bit into the snapshot bit that represents the corresponding snapshot in order to protect the blocks in the snapshot from being overwritten.</p>
    <p num="p-0150">In step <b>710</b>, the inodes of the blkmap file and the snapshot being created are pre-flushed to disk. In addition to flushing the inode of the blkmap file to a block of the inode file (as in step <b>610</b> of <figref idrefs="DRAWINGS">FIG. 6</figref> for a consistency point), the inode of the snapshot being created is also flushed to a block of the inode file. This ensures that the block of the inode file containing the inode of the snapshot is dirty.</p>
    <p num="p-0151">In step <b>720</b>, every block in the blkmap file is dirtied. In step <b>760</b> (described below), all entries in the blkmap file are updated instead of just the entries in dirty blocks. Thus, all blocks of the blkmap file must be marked dirty here to ensure that step <b>730</b> write-allocates disk space for them.</p>
    <p num="p-0152">In step <b>730</b>, disk space is allocated for all dirty blocks in the inode and blkmap files. The dirty blocks include the block in the inode file containing the inode of the blkmap file, which is dirty, and the block containing the inode for the new snapshot.</p>
    <p num="p-0153">In step <b>740</b>, the contents of the root inode for the file system are copied into the inode of the snapshot in the inode file. At this time, every block that is part of the new consistency point and that will be written to disk has disk space allocated for it. Thus, duplicating the root inode in the snapshot inode effectively copies the entire active file system. The actual blocks that will be in the snapshot are the same blocks of the active file system.</p>
    <p num="p-0154">In step <b>750</b>, the inodes of the blkmap file and the snapshot are copied to into the inode file.</p>
    <p num="p-0155">In step <b>760</b>, entries in the blkmap file are updated. In addition to copying the active FS-bit to the CP-bit for the entries, the active FS-bit is also copied to the snapshot bit corresponding to the new snapshot.</p>
    <p num="p-0156">In step <b>770</b>, all dirty blocks in the blkmap and inode files are written to disk.</p>
    <p num="p-0157">Finally, at some time, snapshots themselves are removed from the file system in step <b>760</b>. A snapshot is removed from the file system by clearing its snapshot inode entry in the inode file of the active file system and clearing each bit corresponding to the snapshot number in every entry in the blkmap file. A count is performed also of each bit for the snapshot in all the blkmap entries that are cleared from a set value, thereby providing a count of the blocks that are freed (corresponding amount of disk space that is freed) by deleting the snapshot. The system decides which snapshot to delete on the basis of the oldest snapshots. Users can also choose to delete specified snapshots manually.</p>
    <p num="p-0158">The present invention limits the total number of snapshots and keeps a blkmap file that has entries with multiple bits for tracking the snapshots instead of using pointers having a COW bit as in Episode. An unused block has all zeroes for the bits in its blkmap file entry. Over time, the BITO for the active file system is usually turned on at some instant. Setting BITO identifies the corresponding block as allocated in the active file system. As indicated above, all snapshot bits are initially set to zero. If the active file bit is cleared before any snapshot bits are set, the block is not present in any snapshot stored on disk. Therefore, the block is immediately available for reallocation and cannot be recovered subsequently from a snapshot.</p>
    <p num="p-0159">Generation of a Snapshot</p>
    <p num="p-0160">As described previously, a snapshot is very similar to a consistency point. Therefore, generation of a snapshot is described with reference to the differences between it and the generation of a consistency point shown in <figref idrefs="DRAWINGS">FIGS. 17A-17L</figref>. <figref idrefs="DRAWINGS">FIGS. 21A-21F</figref> illustrates the differences for generating a snapshot.</p>
    <p num="p-0161"> <figref idrefs="DRAWINGS">FIGS. 17A-17D</figref> illustrate the state of the WAFL file system when a snapshot is begun. All dirty inodes are marked as being in the consistency point in step <b>510</b> and regular files are flushed to disk in step <b>520</b>. Thus, initial processing of a snapshot is identical to that for a consistency point. Processing for a snapshot differs in step <b>530</b> from that for a consistency point. The following describes processing of a snapshot according to FIG. <b>7</b>.</p>
    <p num="p-0162">The following description is for a second snapshot of the WAFL file system. A first snapshot is recorded in the blkmap entries of FIG. <b>17</b>C. As indicated in entries <b>2324</b>A-<b>2324</b>M, blocks <b>2304</b>-<b>2306</b>, <b>2310</b>-<b>2320</b>, and <b>2324</b> are contained in the first snapshot. All other snapshot bits (BIT<b>1</b>-BIT<b>20</b>) are assumed to have values of 0 indicating that a corresponding snapshot does not exist on disk. <figref idrefs="DRAWINGS">FIG. 21A</figref> illustrates the file system after steps <b>510</b> and <b>520</b> are completed.</p>
    <p num="p-0163">In step <b>710</b>, inodes <b>2308</b>C and <b>2308</b>D of snapshot <b>2</b> and blkmap file <b>2344</b> are pre-flushed to disk. This ensures that the block of the inode file that is going to contain the snapshot <b>2</b> inode is dirty. In <figref idrefs="DRAWINGS">FIG. 21B</figref>, inodes <b>2308</b>C and <b>2308</b>D are pre-flushed for snapshot <b>2</b> and for blkmap file <b>2344</b>.</p>
    <p num="p-0164">In step <b>720</b>, the entire blkmap file <b>2344</b> is dirtied. This will cause the entire blkmap file <b>2344</b> to be allocated disk space in step <b>730</b>. In step <b>730</b>, disk space is allocated for dirty blocks <b>2308</b> and <b>2326</b> for inode file <b>2346</b> and blkmap file <b>2344</b> as shown in FIG. <b>21</b>C. This is indicated by a double asterisk (**) beside blocks <b>2308</b> and <b>2326</b>. This is different from generating a consistency point where disk space is allocated only for blocks having entries that have changed in the blkmap file <b>2344</b> in step <b>620</b> of FIG. <b>6</b>. Blkmap file <b>2344</b> of <figref idrefs="DRAWINGS">FIG. 21C</figref> comprises a single block <b>2324</b>. However, when blkmap file <b>2344</b> comprises more than one block, disk space is allocated for ail the blocks in step <b>730</b>.</p>
    <p num="p-0165">In step <b>740</b>, the root inode for the new file system is copied into inode <b>2308</b>D for snapshot <b>2</b>. In step <b>750</b>, the inodes <b>2308</b>C and <b>2308</b>D of blkmap file <b>2344</b> and snapshot <b>2</b> are flushed to the inode file as illustrated in FIG. <b>21</b>D. The diagram illustrates that snapshot <b>2</b> inode <b>2308</b>D references blocks <b>2304</b> and <b>2308</b> but not block <b>2306</b>.</p>
    <p num="p-0166">In step <b>760</b>, entries <b>2326</b>A-<b>2326</b>L in block <b>2326</b> of the blkmap file <b>2344</b> are updated as illustrated in FIG. <b>21</b>E. The diagram illustrates that the snapshot <b>2</b> bit (BIT<b>2</b>) is updated as well as the FS-BIT and CP-BIT for each entry <b>2326</b>A-<b>2326</b>L. Thus, blocks <b>2304</b>, <b>2308</b>-<b>2312</b>, <b>2316</b>-<b>2318</b>, <b>2322</b>, and <b>2326</b> are contained in snapshot <b>2</b> whereas blocks <b>2306</b>, <b>2314</b>, <b>2320</b>, and <b>2324</b> are not. In step <b>770</b>, the dirty blocks <b>2308</b> and <b>2326</b> are written to disk.</p>
    <p num="p-0167">Further processing of snapshot <b>2</b> is identical to that for generation of a consistency point illustrated in FIG. <b>5</b>. In step <b>540</b>, the two fsinfo blocks are flushed to disk. Thus, <figref idrefs="DRAWINGS">FIG. 21F</figref> represents the WAFL file system in a consistent state after this step. Files <b>2340</b>, <b>2342</b>, <b>2344</b>, and <b>2346</b> of the consistent file system, after step <b>540</b> is completed, are indicated within dotted lines in FIG. <b>21</b>F. In step <b>550</b>, the consistency point is completed by processing inodes that were not in the consistency point.</p>
    <p num="p-0168">Access Time Overwrites</p>
    <p num="p-0169">Unix file systems must maintain an access time (atime) in each inode. Atime indicates the last time that the file was read. It is updated every time the file is accessed. Consequently, when a file is read the block that contains the inode in the inode file is rewritten to update the inode. This could be disadvantageous for creating snapshots because; as a consequence, reading a file could potentially use up disk space. Further, reading all the files in the file system could cause the entire inode file to be duplicated. The present invention solves this problem.</p>
    <p num="p-0170">Because of atime, a read could potentially consume disk space since modifying an inode causes a new block for the inode file to written on disk. Further, a read operation could potentially fail if a file system is full which is an abnormal condition for a file system to have occur.</p>
    <p num="p-0171">In general, data on disk is not overwritten in the WAFL file system so as to protect data stored on disk. The only exception to this rule is atime overwrites for an inode as illustrated in FIGS. <b>23</b>A-<b>23</b>B: When an atime overwrites occurs, the only data that is modified in a block of the inode file is the atime of one or more of the inodes it contains and the block is rewritten in the same location. This is the only exception in the WAFL system; otherwise new data is always written to new disk locations.</p>
    <p num="p-0172">In <figref idrefs="DRAWINGS">FIG. 23A</figref>, the atimes <b>2423</b> and <b>2433</b> of an inode <b>2422</b> in an old WAFL inode file block <b>2420</b> and the snapshot inode <b>2432</b> that references block <b>2420</b> are illustrated. Inode <b>2422</b> of block <b>2420</b> references direct block <b>2410</b>. The atime <b>2423</b> of inode <b>2422</b> is 4/30 9:15 PM whereas the atime <b>2433</b> of snapshot inode <b>2432</b> is 5/1 10:00 AM. <figref idrefs="DRAWINGS">FIG. 23A</figref> illustrates the file system before direct buffer <b>2410</b> is accessed.</p>
    <p num="p-0173"> <figref idrefs="DRAWINGS">FIG. 23B</figref> illustrates the inode <b>2422</b> of direct block <b>2410</b> after direct block <b>2410</b> has been accessed. As shown in the diagram, the access time <b>2423</b> of inode <b>2422</b> is overwritten with the access time <b>2433</b> of snapshot <b>2432</b> that references it. Thus, the access time <b>2423</b> of inode <b>2422</b> for direct block <b>2410</b> is 5/1 11:23 AM.</p>
    <p num="p-0174">Allowing inode file blocks to be overwritten with new atimes produces a slight inconsistency in the snapshot. The atime of a file in a snapshot can actually be later than the time that the snapshot was created. In order to prevent users from detecting this inconsistency, WAFL adjusts the atime of all files in a snapshot to the time when the snapshot was actually created instead of the time a file was last accessed. This snapshot time is stored in the inode that describes the snapshot as a whole. Thus, when accessed via the snapshot, the access time <b>2423</b> for inode <b>2422</b> is always reported as 5/1 10:00 AM. This occurs both before the update when it may be expected to be 4/30 9:15 PM, and after the update when it may be expected to be 5/1 11:23 AM. When accessed through the active file system, the times are reported as 4/30 9:15 PM and 5/1 11:23 AM before and after the update, respectively.</p>
    <p num="p-0175">In this manner, a method is disclosed for maintaining a file system in a consistent state and for creating read-only copies of the file system.</p>
    </div></div></div><div class="patent-section patent-tabular-section"><a id="backward-citations"></a><div class="patent-section-header"><span class="patent-section-title">Patent Citations</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">Cited Patent</th><th class="patent-data-table-th">Filing date</th><th class="patent-data-table-th">Publication date</th><th class="patent-data-table-th">Applicant</th><th class="patent-data-table-th">Title</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US5182805">US5182805</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Jul 14, 1989</td><td class="patent-data-table-td patent-date-value">Jan 26, 1993</td><td class="patent-data-table-td ">Ncr Corporation</td><td class="patent-data-table-td ">Method and system for determining copy-on-write condition</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US5623666">US5623666</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">May 18, 1995</td><td class="patent-data-table-td patent-date-value">Apr 22, 1997</td><td class="patent-data-table-td ">Lucent Technologies Inc.</td><td class="patent-data-table-td ">Distributed computing system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US5649152">US5649152</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Oct 13, 1994</td><td class="patent-data-table-td patent-date-value">Jul 15, 1997</td><td class="patent-data-table-td ">Vinca Corporation</td><td class="patent-data-table-td ">Method and system for providing a static snapshot of data stored on a mass storage system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US5701480">US5701480</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Apr 14, 1993</td><td class="patent-data-table-td patent-date-value">Dec 23, 1997</td><td class="patent-data-table-td ">Digital Equipment Corporation</td><td class="patent-data-table-td ">Method of operating a digital computer</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US5819292">US5819292</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">May 31, 1995</td><td class="patent-data-table-td patent-date-value">Oct 6, 1998</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Method for maintaining consistent states of a file system and for creating user-accessible read-only copies of a file system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US5873098">US5873098</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Apr 23, 1997</td><td class="patent-data-table-td patent-date-value">Feb 16, 1999</td><td class="patent-data-table-td ">Oracle Corporation</td><td class="patent-data-table-td ">Dynamic snapshot set adjustment</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US5948110">US5948110</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Jun 5, 1995</td><td class="patent-data-table-td patent-date-value">Sep 7, 1999</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Method for providing parity in a raid sub-system using non-volatile memory</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US5963962">US5963962</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Jun 30, 1998</td><td class="patent-data-table-td patent-date-value">Oct 5, 1999</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Method for generating a consistency point</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US6038570">US6038570</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">May 31, 1995</td><td class="patent-data-table-td patent-date-value">Mar 14, 2000</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Method for allocating files in a file system integrated with a RAID disk sub-system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US6138126">US6138126</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Jul 21, 1999</td><td class="patent-data-table-td patent-date-value">Oct 24, 2000</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Method for allocating files in a file system integrated with a raid disk sub-system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US6289356">US6289356</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Sep 14, 1998</td><td class="patent-data-table-td patent-date-value">Sep 11, 2001</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Write anywhere file-system layout</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US6434681">US6434681</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Dec 2, 1999</td><td class="patent-data-table-td patent-date-value">Aug 13, 2002</td><td class="patent-data-table-td ">Emc Corporation</td><td class="patent-data-table-td ">Snapshot copy facility for a data storage system permitting continued host read/write access</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US6480969">US6480969</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Jun 30, 1999</td><td class="patent-data-table-td patent-date-value">Nov 12, 2002</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Providing parity in a RAID sub-system using non-volatile memory</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US6640233">US6640233</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Aug 18, 2000</td><td class="patent-data-table-td patent-date-value">Oct 28, 2003</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Reserving file system blocks</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US6721764">US6721764</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Sep 11, 2001</td><td class="patent-data-table-td patent-date-value">Apr 13, 2004</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Copy on write file system consistency and block usage</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US6751637">US6751637</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Jul 24, 2000</td><td class="patent-data-table-td patent-date-value">Jun 15, 2004</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Allocating files in a file system integrated with a raid disk sub-system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US6823336">US6823336</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Sep 26, 2000</td><td class="patent-data-table-td patent-date-value">Nov 23, 2004</td><td class="patent-data-table-td ">Emc Corporation</td><td class="patent-data-table-td ">Data storage system and method for uninterrupted read-only access to a consistent dataset by one host processor concurrent with read-write access by another host processor</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US20020083037">US20020083037</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Aug 17, 2001</td><td class="patent-data-table-td patent-date-value">Jun 27, 2002</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Instant snapshot</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US20040139125">US20040139125</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Oct 10, 2003</td><td class="patent-data-table-td patent-date-value">Jul 15, 2004</td><td class="patent-data-table-td ">Roger Strassburg</td><td class="patent-data-table-td ">Snapshot copy of data volume during data access</td></tr></table><div class="patent-section-footer">* Cited by examiner</div></div><div class="patent-section patent-tabular-section"><a id="npl-citations"></a><div class="patent-section-header"><span class="patent-section-title">Non-Patent Citations</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th colspan="3"class="patent-data-table-th">Reference</th></tr></thead><tr><td class="patent-data-table-td ">1</td><td class="patent-data-table-td "><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td ">Bach, M.J. "<a href='http://scholar.google.com/scholar?q="The+Design+of+the+UNIX%28R%29+Operating+System"'>The Design of the UNIX(R) Operating System</a>", Englewood Cliffs:Prentice Hall, 1986, pp. 38-140 and 325-329. QA76.76.O63 B33 1986. ISBN 0-13-201799-7.*</td></tr><tr><td class="patent-data-table-td ">2</td><td class="patent-data-table-td "><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td ">Chutani, S. et al. "<a href='http://scholar.google.com/scholar?q="The+Episode+File+Server"'>The Episode File Server</a>", USENIX, Winter 1992, pp. 43-60.*</td></tr><tr><td class="patent-data-table-td ">3</td><td class="patent-data-table-td "><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td ">Hitz, D. "<a href='http://scholar.google.com/scholar?q="An+NFS+File+Server+Appliance"'>An NFS File Server Appliance</a>", Technical Report TR01, Network Appliance Corporation, Aug. 1993.*</td></tr><tr><td class="patent-data-table-td ">4</td><td class="patent-data-table-td "><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td ">Hitz, D. et al. "<a href='http://scholar.google.com/scholar?q="File+System+Design+for+an+NFS+File+Server+Appliance"'>File System Design for an NFS File Server Appliance</a>", USENIX, Jan. 19, 1994.</td></tr><tr><td class="patent-data-table-td ">5</td><td class="patent-data-table-td "><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td ">Hitz, D. et al. "<a href='http://scholar.google.com/scholar?q="Using+UNIX+as+One+Component+of+a+Lightweight+Distributed+Kernel+for+Multiprocessor+File+Servers"'>Using UNIX as One Component of a Lightweight Distributed Kernel for Multiprocessor File Servers</a>", Auspex Systems Inc. Technical Report 5, Jan. 1990.*</td></tr><tr><td class="patent-data-table-td ">6</td><td class="patent-data-table-td "><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td ">Schwartz, A.M. et al. "<a href='http://scholar.google.com/scholar?q="LFS-A+Local+File+System+for+Multiprocessor+NFS+Network+Servers"'>LFS-A Local File System for Multiprocessor NFS Network Servers</a>", Auspex Systems Inc. Technical Report 4, Dec. 1989.*</td></tr></table><div class="patent-section-footer">* Cited by examiner</div></div><div class="patent-section patent-tabular-section"><a id="forward-citations"></a><div class="patent-section-header"><span class="patent-section-title">Referenced by</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">Citing Patent</th><th class="patent-data-table-th">Filing date</th><th class="patent-data-table-th">Publication date</th><th class="patent-data-table-th">Applicant</th><th class="patent-data-table-th">Title</th></tr></thead><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7055010">US7055010</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Nov 3, 2003</td><td class="patent-data-table-td patent-date-value">May 30, 2006</td><td class="patent-data-table-td ">Synology Inc.</td><td class="patent-data-table-td ">Snapshot facility allowing preservation of chronological views on block drives</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7206961">US7206961</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Sep 30, 2002</td><td class="patent-data-table-td patent-date-value">Apr 17, 2007</td><td class="patent-data-table-td ">Emc Corporation</td><td class="patent-data-table-td ">Preserving snapshots during disk-based restore</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7373366">US7373366</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Oct 20, 2005</td><td class="patent-data-table-td patent-date-value">May 13, 2008</td><td class="patent-data-table-td ">American Megatrends, Inc.</td><td class="patent-data-table-td ">Method, system, apparatus, and computer-readable medium for taking and managing snapshots of a storage volume</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7386559">US7386559</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">May 23, 2005</td><td class="patent-data-table-td patent-date-value">Jun 10, 2008</td><td class="patent-data-table-td ">Symantec Operating Corporation</td><td class="patent-data-table-td ">File system encapsulation</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7398354">US7398354</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Jan 21, 2005</td><td class="patent-data-table-td patent-date-value">Jul 8, 2008</td><td class="patent-data-table-td ">International Business Machines Corporation</td><td class="patent-data-table-td ">Achieving data consistency with point-in-time copy operations in a parallel I/O environment</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7412450">US7412450</a></td><td class="patent-data-table-td patent-date-value">May 26, 2004</td><td class="patent-data-table-td patent-date-value">Aug 12, 2008</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and apparatus for identifying tampering of data in a file system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7415653">US7415653</a></td><td class="patent-data-table-td patent-date-value">Apr 21, 2004</td><td class="patent-data-table-td patent-date-value">Aug 19, 2008</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and apparatus for vectored block-level checksum for file system data integrity</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7424574">US7424574</a></td><td class="patent-data-table-td patent-date-value">Apr 21, 2004</td><td class="patent-data-table-td patent-date-value">Sep 9, 2008</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and apparatus for dynamic striping</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7437528">US7437528</a></td><td class="patent-data-table-td patent-date-value">Aug 17, 2004</td><td class="patent-data-table-td patent-date-value">Oct 14, 2008</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Gang blocks</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7464116">US7464116</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Dec 28, 2005</td><td class="patent-data-table-td patent-date-value">Dec 9, 2008</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Method and apparatus for cloning filesystems across computing systems</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7480684">US7480684</a></td><td class="patent-data-table-td patent-date-value">Apr 20, 2006</td><td class="patent-data-table-td patent-date-value">Jan 20, 2009</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and system for object allocation using fill counts</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7496586">US7496586</a></td><td class="patent-data-table-td patent-date-value">May 26, 2004</td><td class="patent-data-table-td patent-date-value">Feb 24, 2009</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and apparatus for compressing data in a file system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7526622">US7526622</a></td><td class="patent-data-table-td patent-date-value">May 26, 2004</td><td class="patent-data-table-td patent-date-value">Apr 28, 2009</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and system for detecting and correcting data errors using checksums and replication</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7533225">US7533225</a></td><td class="patent-data-table-td patent-date-value">Aug 17, 2004</td><td class="patent-data-table-td patent-date-value">May 12, 2009</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and apparatus for enabling adaptive endianness</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7555504">US7555504</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Sep 23, 2003</td><td class="patent-data-table-td patent-date-value">Jun 30, 2009</td><td class="patent-data-table-td ">Emc Corporation</td><td class="patent-data-table-td ">Maintenance of a file version set including read-only and read-write snapshot copies of a production file</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7584229">US7584229</a></td><td class="patent-data-table-td patent-date-value">Oct 31, 2006</td><td class="patent-data-table-td patent-date-value">Sep 1, 2009</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and system for priority-based allocation in a storage pool</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7596739">US7596739</a></td><td class="patent-data-table-td patent-date-value">May 15, 2006</td><td class="patent-data-table-td patent-date-value">Sep 29, 2009</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and system for data replication</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7603568">US7603568</a></td><td class="patent-data-table-td patent-date-value">Apr 21, 2004</td><td class="patent-data-table-td patent-date-value">Oct 13, 2009</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and apparatus for self-validating checksums in a file system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7617253">US7617253</a></td><td class="patent-data-table-td patent-date-value">Dec 18, 2006</td><td class="patent-data-table-td patent-date-value">Nov 10, 2009</td><td class="patent-data-table-td ">Commvault Systems, Inc.</td><td class="patent-data-table-td ">Destination systems and methods for performing data replication</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7617262">US7617262</a></td><td class="patent-data-table-td patent-date-value">Dec 18, 2006</td><td class="patent-data-table-td patent-date-value">Nov 10, 2009</td><td class="patent-data-table-td ">Commvault Systems, Inc.</td><td class="patent-data-table-td ">Systems and methods for monitoring application data in a data replication system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7636743">US7636743</a></td><td class="patent-data-table-td patent-date-value">Dec 18, 2006</td><td class="patent-data-table-td patent-date-value">Dec 22, 2009</td><td class="patent-data-table-td ">Commvault Systems, Inc.</td><td class="patent-data-table-td ">Pathname translation in a data replication system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7651593">US7651593</a></td><td class="patent-data-table-td patent-date-value">Dec 18, 2006</td><td class="patent-data-table-td patent-date-value">Jan 26, 2010</td><td class="patent-data-table-td ">Commvault Systems, Inc.</td><td class="patent-data-table-td ">Systems and methods for performing data replication</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7653832">US7653832</a></td><td class="patent-data-table-td patent-date-value">May 8, 2006</td><td class="patent-data-table-td patent-date-value">Jan 26, 2010</td><td class="patent-data-table-td ">Emc Corporation</td><td class="patent-data-table-td ">Storage array virtualization using a storage block mapping protocol client and server</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7657571">US7657571</a></td><td class="patent-data-table-td patent-date-value">Aug 30, 2005</td><td class="patent-data-table-td patent-date-value">Feb 2, 2010</td><td class="patent-data-table-td ">Microsoft Corporation</td><td class="patent-data-table-td ">Electronic data snapshot generator</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7657671">US7657671</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">Feb 2, 2010</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Adaptive resilvering I/O scheduling</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7661028">US7661028</a></td><td class="patent-data-table-td patent-date-value">Dec 18, 2006</td><td class="patent-data-table-td patent-date-value">Feb 9, 2010</td><td class="patent-data-table-td ">Commvault Systems, Inc.</td><td class="patent-data-table-td ">Rolling cache configuration for a data replication system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7676514">US7676514</a></td><td class="patent-data-table-td patent-date-value">May 8, 2006</td><td class="patent-data-table-td patent-date-value">Mar 9, 2010</td><td class="patent-data-table-td ">Emc Corporation</td><td class="patent-data-table-td ">Distributed maintenance of snapshot copies by a primary processor managing metadata and a secondary processor providing read-write access to a production dataset</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7689877">US7689877</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">Mar 30, 2010</td><td class="patent-data-table-td ">Sun Microsystems, Inc.</td><td class="patent-data-table-td ">Method and system using checksums to repair data</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7716445">US7716445</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">May 11, 2010</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for storing a sparse file using fill counts</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7716519">US7716519</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">May 11, 2010</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for repairing partially damaged blocks</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7743031">US7743031</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Sep 4, 2003</td><td class="patent-data-table-td patent-date-value">Jun 22, 2010</td><td class="patent-data-table-td ">3Par, Inc.</td><td class="patent-data-table-td ">Time and space efficient technique for creating virtual volume copies</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7743225">US7743225</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">Jun 22, 2010</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Ditto blocks</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7747584">US7747584</a></td><td class="patent-data-table-td patent-date-value">Aug 22, 2006</td><td class="patent-data-table-td patent-date-value">Jun 29, 2010</td><td class="patent-data-table-td ">Netapp, Inc.</td><td class="patent-data-table-td ">System and method for enabling de-duplication in a storage system architecture</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7783847">US7783847</a></td><td class="patent-data-table-td patent-date-value">Oct 31, 2006</td><td class="patent-data-table-td patent-date-value">Aug 24, 2010</td><td class="patent-data-table-td ">Oracle America Inc.</td><td class="patent-data-table-td ">Method and system for reallocating blocks in a storage pool</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7792882">US7792882</a></td><td class="patent-data-table-td patent-date-value">Sep 27, 2007</td><td class="patent-data-table-td patent-date-value">Sep 7, 2010</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for block allocation for hybrid drives</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7805600">US7805600</a></td><td class="patent-data-table-td patent-date-value">Aug 9, 2006</td><td class="patent-data-table-td patent-date-value">Sep 28, 2010</td><td class="patent-data-table-td ">Sas Institute Inc.</td><td class="patent-data-table-td ">Computer-implemented systems and methods for managing images</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7809687">US7809687</a></td><td class="patent-data-table-td patent-date-value">Aug 4, 2006</td><td class="patent-data-table-td patent-date-value">Oct 5, 2010</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Searching a backup archive</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7809688">US7809688</a></td><td class="patent-data-table-td patent-date-value">Aug 4, 2006</td><td class="patent-data-table-td patent-date-value">Oct 5, 2010</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Managing backup of content</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7840657">US7840657</a></td><td class="patent-data-table-td patent-date-value">Oct 31, 2006</td><td class="patent-data-table-td patent-date-value">Nov 23, 2010</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and apparatus for power-managing storage devices in a storage pool</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7853566">US7853566</a></td><td class="patent-data-table-td patent-date-value">Aug 4, 2006</td><td class="patent-data-table-td patent-date-value">Dec 14, 2010</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Navigation of electronic backups</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7853567">US7853567</a></td><td class="patent-data-table-td patent-date-value">Aug 4, 2006</td><td class="patent-data-table-td patent-date-value">Dec 14, 2010</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Conflict resolution in recovery of electronic data</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7853750">US7853750</a></td><td class="patent-data-table-td patent-date-value">Jan 30, 2007</td><td class="patent-data-table-td patent-date-value">Dec 14, 2010</td><td class="patent-data-table-td ">Netapp, Inc.</td><td class="patent-data-table-td ">Method and an apparatus to store data patterns</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7856424">US7856424</a></td><td class="patent-data-table-td patent-date-value">Aug 4, 2006</td><td class="patent-data-table-td patent-date-value">Dec 21, 2010</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">User interface for backup management</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7860839">US7860839</a></td><td class="patent-data-table-td patent-date-value">Aug 4, 2006</td><td class="patent-data-table-td patent-date-value">Dec 28, 2010</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Application-based backup-restore of electronic information</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7865673">US7865673</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">Jan 4, 2011</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Multiple replication levels with pooled devices</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7870355">US7870355</a></td><td class="patent-data-table-td patent-date-value">Dec 18, 2006</td><td class="patent-data-table-td patent-date-value">Jan 11, 2011</td><td class="patent-data-table-td ">Commvault Systems, Inc.</td><td class="patent-data-table-td ">Log based data replication system with disk swapping below a predetermined rate</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7873799">US7873799</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">Jan 18, 2011</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system supporting per-file and per-block replication</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7877554">US7877554</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">Jan 25, 2011</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for block reallocation</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7886119">US7886119</a></td><td class="patent-data-table-td patent-date-value">Feb 27, 2007</td><td class="patent-data-table-td patent-date-value">Feb 8, 2011</td><td class="patent-data-table-td ">3Par Inc.</td><td class="patent-data-table-td ">Time and space efficient technique for creating virtual volume copies</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7899989">US7899989</a></td><td class="patent-data-table-td patent-date-value">Apr 20, 2006</td><td class="patent-data-table-td patent-date-value">Mar 1, 2011</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for using a block allocation policy</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7921077">US7921077</a></td><td class="patent-data-table-td patent-date-value">Jun 29, 2006</td><td class="patent-data-table-td patent-date-value">Apr 5, 2011</td><td class="patent-data-table-td ">Netapp, Inc.</td><td class="patent-data-table-td ">System and method for managing data deduplication of storage systems utilizing persistent consistency point images</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7925827">US7925827</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">Apr 12, 2011</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for dirty time logging</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7930477">US7930477</a></td><td class="patent-data-table-td patent-date-value">May 21, 2008</td><td class="patent-data-table-td patent-date-value">Apr 19, 2011</td><td class="patent-data-table-td ">International Business Machines Corporation</td><td class="patent-data-table-td ">Achieving data consistency with point-in-time copy operations in a parallel I/O environment</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7930495">US7930495</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">Apr 19, 2011</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for dirty time log directed resilvering</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7930499">US7930499</a></td><td class="patent-data-table-td patent-date-value">Aug 15, 2008</td><td class="patent-data-table-td patent-date-value">Apr 19, 2011</td><td class="patent-data-table-td ">Digi-Data Corporation</td><td class="patent-data-table-td ">Method to accelerate block level snapshots in archiving storage systems</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7945726">US7945726</a></td><td class="patent-data-table-td patent-date-value">May 8, 2006</td><td class="patent-data-table-td patent-date-value">May 17, 2011</td><td class="patent-data-table-td ">Emc Corporation</td><td class="patent-data-table-td ">Pre-allocation and hierarchical mapping of data blocks distributed from a first processor to a second processor for use in a file system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7949843">US7949843</a></td><td class="patent-data-table-td patent-date-value">Dec 7, 2009</td><td class="patent-data-table-td patent-date-value">May 24, 2011</td><td class="patent-data-table-td ">Netapp, Inc.</td><td class="patent-data-table-td ">Method and system for single pass volume scanning for multiple destination mirroring</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7979402">US7979402</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Apr 30, 2010</td><td class="patent-data-table-td patent-date-value">Jul 12, 2011</td><td class="patent-data-table-td ">Netapp, Inc.</td><td class="patent-data-table-td ">System and method for managing file data during consistency points</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US7987156">US7987156</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Mar 5, 2008</td><td class="patent-data-table-td patent-date-value">Jul 26, 2011</td><td class="patent-data-table-td ">American Megatrends, Inc.</td><td class="patent-data-table-td ">Method, system, apparatus, and computer-readable medium for taking and managing snapshots of a storage volume</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8010900">US8010900</a></td><td class="patent-data-table-td patent-date-value">Jun 8, 2007</td><td class="patent-data-table-td patent-date-value">Aug 30, 2011</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">User interface for electronic backup</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8037279">US8037279</a></td><td class="patent-data-table-td patent-date-value">Jun 12, 2008</td><td class="patent-data-table-td patent-date-value">Oct 11, 2011</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for cross-domain data sharing</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8046547">US8046547</a></td><td class="patent-data-table-td patent-date-value">Jan 11, 2008</td><td class="patent-data-table-td patent-date-value">Oct 25, 2011</td><td class="patent-data-table-td ">American Megatrends, Inc.</td><td class="patent-data-table-td ">Storage system snapshots for continuous file protection</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8082407">US8082407</a></td><td class="patent-data-table-td patent-date-value">Apr 16, 2008</td><td class="patent-data-table-td patent-date-value">Dec 20, 2011</td><td class="patent-data-table-td ">American Megatrends, Inc.</td><td class="patent-data-table-td ">Writable snapshots for boot consolidation</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8095728">US8095728</a></td><td class="patent-data-table-td patent-date-value">Apr 18, 2008</td><td class="patent-data-table-td patent-date-value">Jan 10, 2012</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for power aware I/O scheduling</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8099392">US8099392</a></td><td class="patent-data-table-td patent-date-value">Jun 8, 2007</td><td class="patent-data-table-td patent-date-value">Jan 17, 2012</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Electronic backup of applications</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8117158">US8117158</a></td><td class="patent-data-table-td patent-date-value">Mar 5, 2008</td><td class="patent-data-table-td patent-date-value">Feb 14, 2012</td><td class="patent-data-table-td ">American Megatrends, Inc.</td><td class="patent-data-table-td ">Method, system, apparatus, and computer-readable medium for taking and managing snapshots of a storage volume</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8127096">US8127096</a></td><td class="patent-data-table-td patent-date-value">Jul 15, 2008</td><td class="patent-data-table-td patent-date-value">Feb 28, 2012</td><td class="patent-data-table-td ">American Megatrends, Inc.</td><td class="patent-data-table-td ">High capacity thin provisioned storage server with advanced snapshot mechanism</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8135907">US8135907</a></td><td class="patent-data-table-td patent-date-value">Jun 30, 2008</td><td class="patent-data-table-td patent-date-value">Mar 13, 2012</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for managing wear-level aware file systems</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8165221">US8165221</a></td><td class="patent-data-table-td patent-date-value">Apr 28, 2006</td><td class="patent-data-table-td patent-date-value">Apr 24, 2012</td><td class="patent-data-table-td ">Netapp, Inc.</td><td class="patent-data-table-td ">System and method for sampling based elimination of duplicate data</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8166415">US8166415</a></td><td class="patent-data-table-td patent-date-value">Jun 8, 2007</td><td class="patent-data-table-td patent-date-value">Apr 24, 2012</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">User interface for backup management</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8224780">US8224780</a></td><td class="patent-data-table-td patent-date-value">Jun 15, 2010</td><td class="patent-data-table-td patent-date-value">Jul 17, 2012</td><td class="patent-data-table-td ">Microsoft Corporation</td><td class="patent-data-table-td ">Checkpoints for a file system</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8250043">US8250043</a></td><td class="patent-data-table-td patent-date-value">Aug 19, 2008</td><td class="patent-data-table-td patent-date-value">Aug 21, 2012</td><td class="patent-data-table-td ">Netapp, Inc.</td><td class="patent-data-table-td ">System and method for compression of partially ordered data sets</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8260744">US8260744</a></td><td class="patent-data-table-td patent-date-value">Mar 5, 2008</td><td class="patent-data-table-td patent-date-value">Sep 4, 2012</td><td class="patent-data-table-td ">American Megatrends, Inc.</td><td class="patent-data-table-td ">Method, system, apparatus, and computer-readable medium for taking and managing snapshots of a storage volume</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8271724">US8271724</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Mar 17, 2008</td><td class="patent-data-table-td patent-date-value">Sep 18, 2012</td><td class="patent-data-table-td ">Network Appliance, Inc.</td><td class="patent-data-table-td ">Controlling write request access to a non-volatile log</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8280858">US8280858</a></td><td class="patent-data-table-td patent-date-value">Jun 29, 2009</td><td class="patent-data-table-td patent-date-value">Oct 2, 2012</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Storage pool scrubbing with concurrent snapshots</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8296260">US8296260</a></td><td class="patent-data-table-td patent-date-value">Oct 26, 2010</td><td class="patent-data-table-td patent-date-value">Oct 23, 2012</td><td class="patent-data-table-td ">Netapp, Inc.</td><td class="patent-data-table-td ">System and method for managing data deduplication of storage systems utilizing persistent consistency point images</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8307004">US8307004</a></td><td class="patent-data-table-td patent-date-value">Jun 8, 2007</td><td class="patent-data-table-td patent-date-value">Nov 6, 2012</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Manipulating electronic backups</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8311988">US8311988</a></td><td class="patent-data-table-td patent-date-value">Aug 4, 2006</td><td class="patent-data-table-td patent-date-value">Nov 13, 2012</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Consistent back up of electronic information</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8370853">US8370853</a></td><td class="patent-data-table-td patent-date-value">Aug 4, 2006</td><td class="patent-data-table-td patent-date-value">Feb 5, 2013</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Event notification management</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8392386">US8392386</a></td><td class="patent-data-table-td patent-date-value">Aug 5, 2009</td><td class="patent-data-table-td patent-date-value">Mar 5, 2013</td><td class="patent-data-table-td ">International Business Machines Corporation</td><td class="patent-data-table-td ">Tracking file contents</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8412682">US8412682</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Jun 29, 2006</td><td class="patent-data-table-td patent-date-value">Apr 2, 2013</td><td class="patent-data-table-td ">Netapp, Inc.</td><td class="patent-data-table-td ">System and method for retrieving and using block fingerprints for data deduplication</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8429425">US8429425</a></td><td class="patent-data-table-td patent-date-value">Jun 8, 2007</td><td class="patent-data-table-td patent-date-value">Apr 23, 2013</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Electronic backup and restoration of encrypted data</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8468136">US8468136</a></td><td class="patent-data-table-td patent-date-value">Jun 8, 2007</td><td class="patent-data-table-td patent-date-value">Jun 18, 2013</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Efficient data backup</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8495010">US8495010</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">Jul 23, 2013</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for adaptive metadata replication</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8495024">US8495024</a></td><td class="patent-data-table-td patent-date-value">Dec 9, 2010</td><td class="patent-data-table-td patent-date-value">Jul 23, 2013</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Navigation of electronic backups</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8504516">US8504516</a></td><td class="patent-data-table-td patent-date-value">Jun 15, 2009</td><td class="patent-data-table-td patent-date-value">Aug 6, 2013</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Manipulating electronic backups</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8504527">US8504527</a></td><td class="patent-data-table-td patent-date-value">Dec 10, 2010</td><td class="patent-data-table-td patent-date-value">Aug 6, 2013</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Application-based backup-restore of electronic information</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8538927">US8538927</a></td><td class="patent-data-table-td patent-date-value">Dec 14, 2010</td><td class="patent-data-table-td patent-date-value">Sep 17, 2013</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">User interface for backup management</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8549051">US8549051</a></td><td class="patent-data-table-td patent-date-value">Aug 31, 2006</td><td class="patent-data-table-td patent-date-value">Oct 1, 2013</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Unlimited file system snapshots and clones</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8554734">US8554734</a></td><td class="patent-data-table-td patent-date-value">Jul 15, 2008</td><td class="patent-data-table-td patent-date-value">Oct 8, 2013</td><td class="patent-data-table-td ">American Megatrends, Inc.</td><td class="patent-data-table-td ">Continuous data protection journaling in data storage systems</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8566289">US8566289</a></td><td class="patent-data-table-td patent-date-value">Jan 13, 2012</td><td class="patent-data-table-td patent-date-value">Oct 22, 2013</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Electronic backup of applications</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8635190">US8635190</a></td><td class="patent-data-table-td patent-date-value">Apr 19, 2006</td><td class="patent-data-table-td patent-date-value">Jan 21, 2014</td><td class="patent-data-table-td ">Oracle America, Inc.</td><td class="patent-data-table-td ">Method and system for pruned resilvering using a dirty time log</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8667246">US8667246</a></td><td class="patent-data-table-td patent-date-value">May 13, 2009</td><td class="patent-data-table-td patent-date-value">Mar 4, 2014</td><td class="patent-data-table-td ">Hewlett-Packard Development Company, L.P.</td><td class="patent-data-table-td ">System for virtual disks version control</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8725965">US8725965</a></td><td class="patent-data-table-td patent-date-value">Jun 8, 2007</td><td class="patent-data-table-td patent-date-value">May 13, 2014</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">System setup for electronic backup</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8745523">US8745523</a></td><td class="patent-data-table-td patent-date-value">Jun 8, 2007</td><td class="patent-data-table-td patent-date-value">Jun 3, 2014</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Deletion in electronic backups</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8762345">US8762345</a></td><td class="patent-data-table-td patent-date-value">May 31, 2007</td><td class="patent-data-table-td patent-date-value">Jun 24, 2014</td><td class="patent-data-table-td ">Netapp, Inc.</td><td class="patent-data-table-td ">System and method for accelerating anchor point detection</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/US8775378">US8775378</a></td><td class="patent-data-table-td patent-date-value">Oct 23, 2012</td><td class="patent-data-table-td patent-date-value">Jul 8, 2014</td><td class="patent-data-table-td ">Apple Inc.</td><td class="patent-data-table-td ">Consistent backup of electronic information</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/CN101253495B?cl=en">CN101253495B</a></td><td class="patent-data-table-td patent-date-value">Aug 29, 2006</td><td class="patent-data-table-td patent-date-value">Dec 22, 2010</td><td class="patent-data-table-td "></td><td class="patent-data-table-td ">Electronic data snapshot generator</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2007028067A1?cl=en">WO2007028067A1</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Aug 29, 2006</td><td class="patent-data-table-td patent-date-value">Mar 8, 2007</td><td class="patent-data-table-td ">Microsoft Corp</td><td class="patent-data-table-td ">Electronic data snapshot generator</td></tr><tr><td class="patent-data-table-td citation-patent"><a href="/patents/WO2007111798A1?cl=en">WO2007111798A1</a><span class='patent-tooltip-anchor' data-tooltip-text="Cited by examiner"> *</span></td><td class="patent-data-table-td patent-date-value">Feb 21, 2007</td><td class="patent-data-table-td patent-date-value">Oct 4, 2007</td><td class="patent-data-table-td ">Microsoft Corp</td><td class="patent-data-table-td ">Smart share technologies for automatically processing digital information</td></tr></table><div class="patent-section-footer">* Cited by examiner</div></div><div class="patent-section patent-tabular-section"><a id="classifications"></a><div class="patent-section-header"><span class="patent-section-title">Classifications</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th"> </th><th class="patent-data-table-th"> </th></tr></thead><tr><td class="patent-data-table-td ">U.S. Classification</td><td class="patent-data-table-td "><span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://www.uspto.gov/web/patents/classification/uspc714/defs714.htm&usg=AFQjCNF69HBVWbRkdZeFUtAyhUaqKU35WQ#C714S005100">714/5.1</a></span>, <span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://www.uspto.gov/web/patents/classification/uspc714/defs714.htm&usg=AFQjCNF69HBVWbRkdZeFUtAyhUaqKU35WQ#C714S015000">714/15</a></span>, <span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://www.uspto.gov/web/patents/classification/uspc707/defs707.htm&usg=AFQjCNE7Q7Bg2eD2wcE_fXEcdOe7Yesevw#C707S999202">707/999.202</a></span>, <span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://www.uspto.gov/web/patents/classification/uspc714/defs714.htm&usg=AFQjCNF69HBVWbRkdZeFUtAyhUaqKU35WQ#C714S020000">714/20</a></span>, <span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://www.uspto.gov/web/patents/classification/uspc707/defs707.htm&usg=AFQjCNE7Q7Bg2eD2wcE_fXEcdOe7Yesevw#C707S999201">707/999.201</a></span>, <span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://www.uspto.gov/web/patents/classification/uspc714/defs714.htm&usg=AFQjCNF69HBVWbRkdZeFUtAyhUaqKU35WQ#C714SE11136">714/E11.136</a></span>, <span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://www.uspto.gov/web/patents/classification/uspc707/defs707.htm&usg=AFQjCNE7Q7Bg2eD2wcE_fXEcdOe7Yesevw#C707SE17010">707/E17.01</a></span></td></tr><tr><td class="patent-data-table-td ">International Classification</td><td class="patent-data-table-td "><span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://web2.wipo.int/ipcpub/&usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&notion=scheme&version=20130101&symbol=G06F0017300000">G06F17/30</a></span>, <span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://web2.wipo.int/ipcpub/&usg=AFQjCNER44F5jlVoswCkvW3YEcB5lW4moA#refresh=page&notion=scheme&version=20130101&symbol=G06F0011140000">G06F11/14</a></span></td></tr><tr><td class="patent-data-table-td ">Cooperative Classification</td><td class="patent-data-table-td "><span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://worldwide.espacenet.com/classification&usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=Y10S707/99952">Y10S707/99952</a></span>, <span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://worldwide.espacenet.com/classification&usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=Y10S707/99953">Y10S707/99953</a></span>, <span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://worldwide.espacenet.com/classification&usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=G06F17/30067">G06F17/30067</a></span>, <span class="nested-value"><a href="http://www.google.com/url?id=x4BsBAABERAJ&q=http://worldwide.espacenet.com/classification&usg=AFQjCNGs5WqSrPE3A4ZP63zGuM6PRNfEFA#!/CPC=G06F11/1435">G06F11/1435</a></span></td></tr><tr><td class="patent-data-table-td ">European Classification</td><td class="patent-data-table-td "><span class="nested-value">G06F11/14A8F</span>, <span class="nested-value">G06F17/30F</span></td></tr></table><div class="patent-section-footer"></div></div><div class="patent-section patent-tabular-section"><a id="legal-events"></a><div class="patent-section-header"><span class="patent-section-title">Legal Events</span></div><table class="patent-data-table"><thead class="patent-data-table-thead"><tr class="patent-data-table"><th class="patent-data-table-th">Date</th><th class="patent-data-table-th">Code</th><th class="patent-data-table-th">Event</th><th class="patent-data-table-th">Description</th></tr></thead><tr><td class="patent-data-table-td patent-date-value">Feb 19, 2013</td><td class="patent-data-table-td ">B1</td><td class="patent-data-table-td ">Reexamination certificate first reexamination</td><td class="patent-data-table-td "><div class="nested-key-value"><span class="nested-key">Free format text: </span><span class="nested-value">CLAIMS 1-24 ARE CANCELLED.NEW CLAIMS 25-103 ARE ADDED AND DETERMINED TO BE PATENTABLE.</span></div></td></tr><tr><td class="patent-data-table-td patent-date-value">Nov 12, 2012</td><td class="patent-data-table-td ">FPAY</td><td class="patent-data-table-td ">Fee payment</td><td class="patent-data-table-td "><div class="nested-key-value"><span class="nested-key">Year of fee payment: </span><span class="nested-value">8</span></div></td></tr><tr><td class="patent-data-table-td patent-date-value">Nov 10, 2008</td><td class="patent-data-table-td ">FPAY</td><td class="patent-data-table-td ">Fee payment</td><td class="patent-data-table-td "><div class="nested-key-value"><span class="nested-key">Year of fee payment: </span><span class="nested-value">4</span></div></td></tr><tr><td class="patent-data-table-td patent-date-value">Feb 26, 2008</td><td class="patent-data-table-td ">RR</td><td class="patent-data-table-td ">Request for reexamination filed</td><td class="patent-data-table-td "><div class="nested-key-value"><span class="nested-key">Effective date: </span><span class="nested-value">20080114</span></div></td></tr></table><div class="patent-section-footer"></div></div><div class="modal-dialog" id="patent-images-lightbox"><div class="patent-lightbox-controls"><div class="patent-lightbox-rotate-controls"><div class="patent-lightbox-rotation-text">Rotate</div><div class="rotate-icon rotate-ccw-icon"></div><div class="rotate-icon rotate-cw-icon"></div></div><div class="patent-lightbox-index-counter"></div><a class="patent-lightbox-fullsize-link" target="_blank">Original Image</a><div class="patent-drawings-control patent-drawings-next"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_right.png" alt="Next page"width="21" height="21" /></div><div class="patent-drawings-control patent-drawings-prev"><img class="patent-drawings-button-img"src="/googlebooks/images/kennedy/page_left.png" alt="Previous page"width="21" height="21" /></div></div><div class="modal-dialog-content"><div class="patent-lightbox-image-holder"><div class="patent-lightbox-placeholder"></div></div></div></div><script>_OC_initPatentsAtb({image_not_available_html: " Image not available"});</script></div></div></div></td></tr></table><script>(function() {var href = window.location.href;if (href.indexOf('?') !== -1) {var parameters = href.split('?')[1].split('&');for (var i = 0; i < parameters.length; i++) {var param = parameters[i].split('=');if (param[0] == 'focus') {var elem = document.getElementById(param[1]);if (elem) {elem.focus();}}}}})();</script><script>_OC_addFlags({LockSrc:"/books/javascript/lock_8a2b04e7bf975d5171d8e4c0b6365c7a.js", Host:"http://www.google.com/", IsBooksRentalEnabled:1, IsWebstoreDisplayCaseEnabled:1, IsObfuscationEnabled:1, IsBrowsingHistoryEnabled:1, IsWebReaderSvgEnabled:0, IsGeoLayerEnabled:1, IsImageModeNotesEnabled:1, IsCopyMenuItemEnabled:1, IsGiftingEnabled:0, IsWebReaderUniversalPaginatorEnabled:0, IsOfflineBubbleEnabled:1, IsReaderEnabledForPlayRequests:1, IsFutureOnSaleVolumesEnabled:1, IsOfflineRestrictedCopyEnabled:1, IsBooksUnifiedLeftNavEnabled:1, IsRestrictedCopyEnabled:1, IsZipitFolderCollectionEnabled:1, IsEndOfSampleRecommendationsEnabled:1, IsRatingsOnBookcardsEnabled:1, IsAdsDisabled:0, IsIframePageDisplayEnabled:0, IsEmbeddedMediaEnabled:1, IsImageModeAnnotationsEnabled:1, IsMyLibraryGooglePlusEnabled:1, IsImagePageProviderEnabled:0, IsBookcardListPriceSmall:0, IsInternalUser:0, IsBooksShareButtonEnabled:0, IsPreOrdersEnabled:0, IsDisabledRandomBookshelves:0, WebstoreDisplayCasePosition:3});_OC_Run({"enable_p13n":false,"add_vol_to_collection_base_url":"http://www.google.com/patents?op=add\u0026sig=ACfU3U3eXRrTkr9LGgcVE_277suqR9DI0Q\u0026id=x4BsBAABERAJ","remove_vol_from_collection_base_url":"http://www.google.com/patents?op=remove\u0026sig=ACfU3U3BrQdkIAHFyd03sayq9lCRDDwU3g\u0026id=x4BsBAABERAJ","logged_in":false,"p13n_save_user_settings_url":"http://www.google.com/patents?op=edit_user_settings\u0026sig=ACfU3U0SaxudRKdBxJthjhjSc2lhgiubvg","is_cobrand":false,"sign_in_url":"https://www.google.com/accounts/Login?service=\u0026continue=http://www.google.com/patents%3Fhl%3Den\u0026hl=en","is_play_enabled":true}, {"volume_id":"","is_ebook":true,"volumeresult":{"has_flowing_text":false,"has_scanned_text":true,"can_download_pdf":false,"can_download_epub":false,"is_pdf_drm_enabled":false,"is_epub_drm_enabled":false,"download_pdf_url":"http://www.google.com/patents/download/Copy_on_write_file_system_consistency_an.pdf?id=x4BsBAABERAJ\u0026output=pdf\u0026sig=ACfU3U1rQ3iEoWsKiqBOsWc3FgEFF_oZhg"},"sample_url":"http://www.google.com/patents/reader?id=x4BsBAABERAJ\u0026printsec=frontcover\u0026output=reader\u0026source=gbs_atb_hover","is_browsable":true,"is_public_domain":true}, {});</script><div id="footer_table" style="font-size:83%;text-align:center;position:relative;top:20px;height:4.5em;margin-top:2em"><div style="margin-bottom:8px"><a href=http://www.google.com/><nobr>Google&nbsp;Home</nobr></a> - <a href=//www.google.com/patents/sitemap/><nobr>Sitemap</nobr></a> - <a href=http://www.google.com/googlebooks/uspto.html><nobr>USPTO Bulk Downloads</nobr></a> - <a href=/intl/en/privacy/><nobr>Privacy Policy</nobr></a> - <a href=/intl/en/policies/terms/><nobr>Terms of Service</nobr></a> - <a href=https://support.google.com/faqs/answer/2539193?hl=en><nobr>About Google Patents</nobr></a> - <a href="http://www.google.com/tools/feedback/intl/en/error.html" onclick="try{_OC_startFeedback({productId: '72792',locale: 'en'});return false;}catch(e){}"><nobr>Send Feedback</nobr></a></div><span>Data provided by IFI CLAIMS Patent Services</span><br><span >&copy;2012 Google</span></div> <script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">var pageTracker = _gat._getTracker("UA-27188110-1");pageTracker._setCookiePath("/patents/");pageTracker._trackPageview();</script> </body></html>